var starter=function(exports){"use strict";var failure=["Failure",-2],invalid_argument=["Invalid_argument",-3],division_by_zero=["Division_by_zero",-5],not_found=["Not_found",-6],match_failure=["Match_failure",-7],assert_failure=["Assert_failure",-10];failure.tag=248,invalid_argument.tag=248,division_by_zero.tag=248,not_found.tag=248,match_failure.tag=248,assert_failure.tag=248;function caml_array_sub(x,offset,len){for(var result=new Array(len),j=0,i=offset;j<len;)result[j]=x[i],j=j+1|0,i=i+1|0;return result}function caml_array_set(xs,index,newval){if(index<0||index>=xs.length)throw[invalid_argument,"index out of bounds"];return xs[index]=newval,0}function caml_array_get(xs,index){if(index<0||index>=xs.length)throw[invalid_argument,"index out of bounds"];return xs[index]}function caml_make_vect(len,init){for(var b=new Array(len),i=0,i_finish=len-1|0;i<=i_finish;++i)b[i]=init;return b}function app(_f,_args){for(;;){var args=_args,f=_f,arity=f.length,arity$1=arity||1,d=arity$1-args.length|0;if(d){if(d<0){_args=caml_array_sub(args,arity$1,0|-d),_f=f.apply(null,caml_array_sub(args,0,arity$1));continue}return function(f,args){return function(x){return app(f,args.concat([x]))}}(f,args)}return f.apply(null,args)}}function _1(o,a0){var arity=o.length;return 1===arity?o(a0):function(o,a0,arity){if(arity>7||arity<0)return app(o,[a0]);switch(arity){case 0:case 1:return o(a0);case 2:return function(param){return o(a0,param)};case 3:return function(param,param$1){return o(a0,param,param$1)};case 4:return function(param,param$1,param$2){return o(a0,param,param$1,param$2)};case 5:return function(param,param$1,param$2,param$3){return o(a0,param,param$1,param$2,param$3)};case 6:return function(param,param$1,param$2,param$3,param$4){return o(a0,param,param$1,param$2,param$3,param$4)};case 7:return function(param,param$1,param$2,param$3,param$4,param$5){return o(a0,param,param$1,param$2,param$3,param$4,param$5)}}}(o,a0,arity)}function _2(o,a0,a1){var arity=o.length;return 2===arity?o(a0,a1):function(o,a0,a1,arity){if(arity>7||arity<0)return app(o,[a0,a1]);switch(arity){case 0:case 1:return app(o(a0),[a1]);case 2:return o(a0,a1);case 3:return function(param){return o(a0,a1,param)};case 4:return function(param,param$1){return o(a0,a1,param,param$1)};case 5:return function(param,param$1,param$2){return o(a0,a1,param,param$1,param$2)};case 6:return function(param,param$1,param$2,param$3){return o(a0,a1,param,param$1,param$2,param$3)};case 7:return function(param,param$1,param$2,param$3,param$4){return o(a0,a1,param,param$1,param$2,param$3,param$4)}}}(o,a0,a1,arity)}function _3(o,a0,a1,a2){var arity=o.length;return 3===arity?o(a0,a1,a2):function(o,a0,a1,a2,arity){var exit=0;if(arity>7||arity<0)return app(o,[a0,a1,a2]);switch(arity){case 0:case 1:exit=1;break;case 2:return app(o(a0,a1),[a2]);case 3:return o(a0,a1,a2);case 4:return function(param){return o(a0,a1,a2,param)};case 5:return function(param,param$1){return o(a0,a1,a2,param,param$1)};case 6:return function(param,param$1,param$2){return o(a0,a1,a2,param,param$1,param$2)};case 7:return function(param,param$1,param$2,param$3){return o(a0,a1,a2,param,param$1,param$2,param$3)}}return 1===exit?app(o(a0),[a1,a2]):void 0}(o,a0,a1,a2,arity)}function _4(o,a0,a1,a2,a3){var arity=o.length;return 4===arity?o(a0,a1,a2,a3):function(o,a0,a1,a2,a3,arity){var exit=0;if(arity>7||arity<0)return app(o,[a0,a1,a2,a3]);switch(arity){case 0:case 1:exit=1;break;case 2:return app(o(a0,a1),[a2,a3]);case 3:return app(o(a0,a1,a2),[a3]);case 4:return o(a0,a1,a2,a3);case 5:return function(param){return o(a0,a1,a2,a3,param)};case 6:return function(param,param$1){return o(a0,a1,a2,a3,param,param$1)};case 7:return function(param,param$1,param$2){return o(a0,a1,a2,a3,param,param$1,param$2)}}return 1===exit?app(o(a0),[a1,a2,a3]):void 0}(o,a0,a1,a2,a3,arity)}function _5(o,a0,a1,a2,a3,a4){var arity=o.length;return 5===arity?o(a0,a1,a2,a3,a4):function(o,a0,a1,a2,a3,a4,arity){var exit=0;if(arity>7||arity<0)return app(o,[a0,a1,a2,a3,a4]);switch(arity){case 0:case 1:exit=1;break;case 2:return app(o(a0,a1),[a2,a3,a4]);case 3:return app(o(a0,a1,a2),[a3,a4]);case 4:return app(o(a0,a1,a2,a3),[a4]);case 5:return o(a0,a1,a2,a3,a4);case 6:return function(param){return o(a0,a1,a2,a3,a4,param)};case 7:return function(param,param$1){return o(a0,a1,a2,a3,a4,param,param$1)}}return 1===exit?app(o(a0),[a1,a2,a3,a4]):void 0}(o,a0,a1,a2,a3,a4,arity)}function _6(o,a0,a1,a2,a3,a4,a5){var arity=o.length;return 6===arity?o(a0,a1,a2,a3,a4,a5):function(o,a0,a1,a2,a3,a4,a5,arity){var exit=0;if(arity>7||arity<0)return app(o,[a0,a1,a2,a3,a4,a5]);switch(arity){case 0:case 1:exit=1;break;case 2:return app(o(a0,a1),[a2,a3,a4,a5]);case 3:return app(o(a0,a1,a2),[a3,a4,a5]);case 4:return app(o(a0,a1,a2,a3),[a4,a5]);case 5:return app(o(a0,a1,a2,a3,a4),[a5]);case 6:return o(a0,a1,a2,a3,a4,a5);case 7:return function(param){return o(a0,a1,a2,a3,a4,a5,param)}}return 1===exit?app(o(a0),[a1,a2,a3,a4,a5]):void 0}(o,a0,a1,a2,a3,a4,a5,arity)}function _7(o,a0,a1,a2,a3,a4,a5,a6){var arity=o.length;return 7===arity?o(a0,a1,a2,a3,a4,a5,a6):function(o,a0,a1,a2,a3,a4,a5,a6,arity){var exit=0;if(arity>7||arity<0)return app(o,[a0,a1,a2,a3,a4,a5,a6]);switch(arity){case 0:case 1:exit=1;break;case 2:return app(o(a0,a1),[a2,a3,a4,a5,a6]);case 3:return app(o(a0,a1,a2),[a3,a4,a5,a6]);case 4:return app(o(a0,a1,a2,a3),[a4,a5,a6]);case 5:return app(o(a0,a1,a2,a3,a4),[a5,a6]);case 6:return app(o(a0,a1,a2,a3,a4,a5),[a6]);case 7:return o(a0,a1,a2,a3,a4,a5,a6)}return 1===exit?app(o(a0),[a1,a2,a3,a4,a5,a6]):void 0}(o,a0,a1,a2,a3,a4,a5,a6,arity)}function _8(o,a0,a1,a2,a3,a4,a5,a6,a7){var arity=o.length;return 8===arity?o(a0,a1,a2,a3,a4,a5,a6,a7):function(o,a0,a1,a2,a3,a4,a5,a6,a7,arity){var exit=0;if(arity>7||arity<0)return app(o,[a0,a1,a2,a3,a4,a5,a6,a7]);switch(arity){case 0:case 1:exit=1;break;case 2:return app(o(a0,a1),[a2,a3,a4,a5,a6,a7]);case 3:return app(o(a0,a1,a2),[a3,a4,a5,a6,a7]);case 4:return app(o(a0,a1,a2,a3),[a4,a5,a6,a7]);case 5:return app(o(a0,a1,a2,a3,a4),[a5,a6,a7]);case 6:return app(o(a0,a1,a2,a3,a4,a5),[a6,a7]);case 7:return app(o(a0,a1,a2,a3,a4,a5,a6),[a7])}return 1===exit?app(o(a0),[a1,a2,a3,a4,a5,a6,a7]):void 0}(o,a0,a1,a2,a3,a4,a5,a6,a7,arity)}function __(tag,block){return block.tag=tag,block}function caml_int_compare(x,y){return x<y?-1:x===y?0:1}function caml_compare(_a,_b){for(;;){var b=_b,a=_a;if(a===b)return 0;var a_type=typeof a,b_type=typeof b;if("string"===a_type){return a<b?-1:a===b?0:1}var is_b_number=+("number"===b_type);if(0!==+("number"===a_type))return 0!==is_b_number?caml_int_compare(a,b):-1;if(0!==is_b_number)return 1;if("boolean"===a_type||"undefined"===a_type||null===a){return a===b?0:a<b?-1:1}if("function"===a_type||"function"===b_type)throw[invalid_argument,"compare: functional value"];var tag_a=0|a.tag,tag_b=0|b.tag;if(250!==tag_a)if(250!==tag_b){if(248===tag_a)return caml_int_compare(a[1],b[1]);if(251===tag_a)throw[invalid_argument,"equal: abstract value"];if(tag_a!==tag_b)return tag_a<tag_b?-1:1;var len_a=0|a.length,len_b=0|b.length;if(len_a===len_b)for(var a$1=a,b$1=b,_i=0,same_length=len_a;;){var i=_i;if(i===same_length)return 0;var res=caml_compare(a$1[i],b$1[i]);if(0!==res)return res;_i=i+1|0}else if(len_a<len_b)for(var a$2=a,b$2=b,_i$1=0,short_length=len_a;;){var i$1=_i$1;if(i$1===short_length)return-1;var res$1=caml_compare(a$2[i$1],b$2[i$1]);if(0!==res$1)return res$1;_i$1=i$1+1|0}else for(var a$3=a,b$3=b,_i$2=0,short_length$1=len_b;;){var i$2=_i$2;if(i$2===short_length$1)return 1;var res$2=caml_compare(a$3[i$2],b$3[i$2]);if(0!==res$2)return res$2;_i$2=i$2+1|0}}else _b=b[0];else _a=a[0]}}function caml_equal(_a,_b){for(;;){var b=_b,a=_a;if(a===b)return 1;var a_type=typeof a;if("string"===a_type||"number"===a_type||"boolean"===a_type||"undefined"===a_type||null===a)return 0;var b_type=typeof b;if("function"===a_type||"function"===b_type)throw[invalid_argument,"equal: functional value"];if("number"===b_type||"undefined"===b_type||null===b)return 0;var tag_a=0|a.tag,tag_b=0|b.tag;if(250!==tag_a)if(250!==tag_b){if(248===tag_a)return+(a[1]===b[1]);if(251===tag_a)throw[invalid_argument,"equal: abstract value"];if(tag_a!==tag_b)return 0;var len_a=0|a.length;if(len_a!==(0|b.length))return 0;for(var a$1=a,b$1=b,_i=0,same_length=len_a;;){var i=_i;if(i===same_length)return 1;if(!caml_equal(a$1[i],b$1[i]))return 0;_i=i+1|0}}else _b=b[0];else _a=a[0]}}function caml_notequal(a,b){return 1-caml_equal(a,b)}function caml_sys_random_seed(){return[(4294967295^(0|Date.now()))*Math.random()|0]}function div(x,y){if(0===y)throw division_by_zero;return x/y|0}var imul=Math.imul||function(x,y){return((x>>16)*(y|=0)<<16)+(65535&x)*y|0},repeat=String.prototype.repeat&&function(count,self){return self.repeat(count)}||function(count,self){if(0==self.length||0==count)return"";if(self.length*count>=1<<28)throw new RangeError("repeat count must not overflow maximum string size");for(var rpt="";1==(1&count)&&(rpt+=self),0!=(count>>>=1);)self+=self;return rpt},min_int$1=[-2147483648,0],max_int$1=[134217727,1],one=[0,1],zero=[0,0],neg_one=[-1,4294967295];function neg_signed(x){return+(0!=(2147483648&x))}function add(param,param$1){var other_low_=param$1[1],this_low_=param[1],lo=this_low_+other_low_&4294967295,overflow=neg_signed(this_low_)&&(neg_signed(other_low_)||!neg_signed(lo))||neg_signed(other_low_)&&!neg_signed(lo)?1:0;return[param[0]+param$1[0]+overflow&4294967295,lo>>>0]}function eq(x,y){return x[0]===y[0]?+(x[1]===y[1]):0}function neg(x){return eq(x,min_int$1)?min_int$1:add([-1^(param=x)[0],(-1^param[1])>>>0],one);var param}function sub(x,y){return add(x,neg(y))}function lsl_(x,numBits){if(numBits){var lo=x[1];if(numBits>=32)return[lo<<(numBits-32|0),0];return[lo>>>(32-numBits|0)|x[0]<<numBits,lo<<numBits>>>0]}return x}function asr_(x,numBits){if(numBits){var hi=x[0];if(numBits<32){return[hi>>numBits,(hi<<(32-numBits|0)|x[1]>>>numBits)>>>0]}return[hi>=0?0:-1,hi>>(numBits-32|0)>>>0]}return x}function mul(_this,_other){for(;;){var lo,other=_other,$$this=_this,exit=0,this_hi=$$this[0],exit$1=0,exit$2=0,exit$3=0;if(0!==this_hi)exit$3=4;else{if(0===$$this[1])return zero;exit$3=4}if(4===exit$3)if(0!==other[0])exit$2=3;else{if(0===other[1])return zero;exit$2=3}if(3===exit$2&&(-2147483648!==this_hi?exit$1=2:0!==$$this[1]?exit$1=2:(lo=other[1],exit=1)),2===exit$1){var other_hi=other[0],lo$1=$$this[1],exit$4=0;if(-2147483648!==other_hi?exit$4=3:0!==other[1]?exit$4=3:(lo=lo$1,exit=1),3===exit$4){var other_lo=other[1];if(this_hi<0){if(other_hi<0){_other=neg(other),_this=neg($$this);continue}return neg(mul(neg($$this),other))}if(other_hi<0)return neg(mul($$this,neg(other)));var a32=65535&this_hi,a16=lo$1>>>16,a00=65535&lo$1,b32=65535&other_hi,b16=other_lo>>>16,b00=65535&other_lo,c48=0,c32=0,c16=0,c00=a00*b00;c48=(c32=(c32=(c16=(c00>>>16)+a16*b00)>>>16)+((c16=(65535&c16)+a00*b16)>>>16)+a32*b00)>>>16,c48+=(c32=(65535&c32)+a16*b16)>>>16,c48+=(c32=(65535&c32)+a00*b32)>>>16;return[(c32&=65535)|(c48=c48+((this_hi>>>16)*b00+a32*b16+a16*b32+a00*(other_hi>>>16))&65535)<<16,(65535&c00|(65535&c16)<<16)>>>0]}}if(1===exit)return 0==(1&lo)?zero:min_int$1}}function ge(param,param$1){var other_hi=param$1[0],hi=param[0];return hi>other_hi?1:hi<other_hi?0:+(param[1]>=param$1[1])}function neq(x,y){return 1-eq(x,y)}function lt(x,y){return 1-ge(x,y)}function gt(x,y){return x[0]>y[0]?1:x[0]<y[0]?0:+(x[1]>y[1])}function to_float(param){return 4294967296*param[0]+param[1]}var two_ptr_32_dbl=Math.pow(2,32),two_ptr_63_dbl=Math.pow(2,63),neg_two_ptr_63=-Math.pow(2,63);function of_float(x){if(isNaN(x)||!isFinite(x))return zero;if(x<=neg_two_ptr_63)return min_int$1;if(x+1>=two_ptr_63_dbl)return max_int$1;if(x<0)return neg(of_float(-x));return[x/two_ptr_32_dbl|0,(x%two_ptr_32_dbl|0)>>>0]}function div$1(_self,_other){for(;;){var other=_other,self=_self,self_hi=self[0],exit=0,exit$1=0;if(0!==other[0])exit$1=2;else{if(0===other[1])throw division_by_zero;exit$1=2}if(2===exit$1)if(-2147483648!==self_hi)if(0!==self_hi)exit=1;else{if(0===self[1])return zero;exit=1}else if(0!==self[1])exit=1;else{if(eq(other,one)||eq(other,neg_one))return self;if(eq(other,min_int$1))return one;var other_hi=other[0],approx=lsl_(div$1(asr_(self,1),other),1),exit$2=0;if(0!==approx[0])exit$2=3;else{if(0===approx[1])return other_hi<0?one:neg(one);exit$2=3}if(3===exit$2){return add(approx,div$1(add(self,neg(mul(other,approx))),other))}}if(1===exit){var other_hi$1=other[0],exit$3=0;if(-2147483648!==other_hi$1)exit$3=2;else{if(0===other[1])return zero;exit$3=2}if(2===exit$3){if(self_hi<0){if(other_hi$1<0){_other=neg(other),_self=neg(self);continue}return neg(div$1(neg(self),other))}if(other_hi$1<0)return neg(div$1(self,neg(other)));for(var res=zero,rem$1=self;ge(rem$1,other);){for(var approx$1=Math.max(1,Math.floor(to_float(rem$1)/to_float(other))),log2=Math.ceil(Math.log(approx$1)/Math.LN2),delta=log2<=48?1:Math.pow(2,log2-48),approxRes=of_float(approx$1),approxRem=mul(approxRes,other);approxRem[0]<0||gt(approxRem,rem$1);)approxRem=mul(approxRes=of_float(approx$1-=delta),other);0===(param=approxRes)[0]&&0===param[1]&&(approxRes=one),res=add(res,approxRes),rem$1=add(rem$1,neg(approxRem))}return res}}}var param}function div_mod(self,other){var quotient=div$1(self,other);return[quotient,add(self,neg(mul(quotient,other)))]}function of_int32(lo){return[lo<0?-1:0,lo>>>0]}function discard_sign(x){return[2147483647&x[0],x[1]]}function lowercase(c){return c>=65&&c<=90||c>=192&&c<=214||c>=216&&c<=222?c+32|0:c}function parse_format(fmt){var len=fmt.length;if(len>31)throw[invalid_argument,"format_int: format too long"];for(var f=["+","-"," ",0,2,0,0,0,1,-1,"f"],_i=0;;){var i=_i;if(i>=len)return f;var c=fmt.charCodeAt(i),exit=0;if(c>=69)if(c>=88)if(c>=121)exit=1;else switch(c-88|0){case 0:f[4]=1,f[7]=1,_i=i+1|0;continue;case 13:case 14:case 15:exit=5;break;case 12:case 17:exit=4;break;case 23:f[4]=0,_i=i+1|0;continue;case 29:f[4]=2,_i=i+1|0;continue;case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 16:case 18:case 19:case 20:case 21:case 22:case 24:case 25:case 26:case 27:case 28:case 30:case 31:exit=1;break;case 32:f[4]=1,_i=i+1|0;continue}else{if(!(c>=72)){f[5]=1,f[7]=1,f[10]=String.fromCharCode(lowercase(c)),_i=i+1|0;continue}exit=1}else{var switcher=c-32|0;if(switcher>25||switcher<0)exit=1;else switch(switcher){case 3:f[3]=1,_i=i+1|0;continue;case 0:case 11:exit=2;break;case 13:f[0]="-",_i=i+1|0;continue;case 14:f[9]=0;for(var j=i+1|0;function(j){return function(){var w=fmt.charCodeAt(j)-48|0;return+(w>=0&&w<=9)}}(j)();)f[9]=(imul(f[9],10)+fmt.charCodeAt(j)|0)-48|0,j=j+1|0;_i=j;continue;case 1:case 2:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 12:case 15:exit=1;break;case 16:f[2]="0",_i=i+1|0;continue;case 17:case 18:case 19:case 20:case 21:case 22:case 23:case 24:case 25:exit=3}}switch(exit){case 1:_i=i+1|0;continue;case 2:f[1]=String.fromCharCode(c),_i=i+1|0;continue;case 3:f[6]=0;for(var j$1=i;function(j$1){return function(){var w=fmt.charCodeAt(j$1)-48|0;return+(w>=0&&w<=9)}}(j$1)();)f[6]=(imul(f[6],10)+fmt.charCodeAt(j$1)|0)-48|0,j$1=j$1+1|0;_i=j$1;continue;case 4:f[5]=1,f[4]=2,_i=i+1|0;continue;case 5:f[5]=1,f[10]=String.fromCharCode(c),_i=i+1|0;continue}}}function finish_formatting(param,rawbuffer){var justify=param[0],signstyle=param[1],filter=param[2],alternate=param[3],base=param[4],signedconv=param[5],width=param[6],uppercase=param[7],sign=param[8],len=rawbuffer.length;signedconv&&(sign<0||"-"!==signstyle)&&(len=len+1|0),alternate&&(base?1===base&&(len=len+2|0):len=len+1|0);var buffer="";if("+"===justify&&" "===filter)for(var i=len,i_finish=width-1|0;i<=i_finish;++i)buffer+=filter;if(signedconv&&(sign<0?buffer+="-":"-"!==signstyle&&(buffer+=signstyle)),alternate&&0===base&&(buffer+="0"),alternate&&1===base&&(buffer+="0x"),"+"===justify&&"0"===filter)for(var i$1=len,i_finish$1=width-1|0;i$1<=i_finish$1;++i$1)buffer+=filter;if(buffer=uppercase?buffer+rawbuffer.toUpperCase():buffer+rawbuffer,"-"===justify)for(var i$2=len,i_finish$2=width-1|0;i$2<=i_finish$2;++i$2)buffer+=" ";return buffer}function caml_format_int(fmt,i){if("%d"===fmt)return String(i);var f$1=parse_format(fmt),i$1=i,s=(i$1<0?f$1[5]?(f$1[8]=-1,-i$1):i$1>>>0:i$1).toString(function(param){switch(param){case 0:return 8;case 1:return 16;case 2:return 10}}(f$1[4]));if(f$1[9]>=0){f$1[2]=" ";var n=f$1[9]-s.length|0;n>0&&(s=repeat(n,"0")+s)}return finish_formatting(f$1,s)}function caml_int64_format(fmt,x){var f=parse_format(fmt),x$1=f[5]&&lt(x,[0,0])?(f[8]=-1,neg(x)):x,s="";switch(f[4]){case 0:var wbase=[0,8],cvtbl="01234567";if(lt(x$1,[0,0])){var match$1=div_mod(discard_sign(x$1),wbase),quotient=add([268435456,0],match$1[0]),modulus=match$1[1];for(s=String.fromCharCode(cvtbl.charCodeAt(0|modulus[1]))+s;neq(quotient,[0,0]);){var match$2=div_mod(quotient,wbase);quotient=match$2[0],modulus=match$2[1],s=String.fromCharCode(cvtbl.charCodeAt(0|modulus[1]))+s}}else{var match$3=div_mod(x$1,wbase),quotient$1=match$3[0],modulus$1=match$3[1];for(s=String.fromCharCode(cvtbl.charCodeAt(0|modulus$1[1]))+s;neq(quotient$1,[0,0]);){var match$4=div_mod(quotient$1,wbase);quotient$1=match$4[0],modulus$1=match$4[1],s=String.fromCharCode(cvtbl.charCodeAt(0|modulus$1[1]))+s}}break;case 1:s=function(x){var aux=function(v){return(v>>>0).toString(16)},match=x[0],match$1=x[1],exit=0;if(0!==match)exit=1;else{if(0===match$1)return"0";exit=1}if(1===exit){if(0!==match$1){if(0!==match){var lo=aux(x[1]),pad=8-lo.length|0;return pad<=0?aux(x[0])+lo:aux(x[0])+(repeat(pad,"0")+lo)}return aux(x[1])}return aux(x[0])+"00000000"}}(x$1)+s;break;case 2:var wbase$1=[0,10];if(lt(x$1,[0,0])){var match$5=div_mod(discard_sign(x$1),wbase$1),match$6=div_mod(add([0,8],match$5[1]),wbase$1),quotient$2=add(add([214748364,3435973836],match$5[0]),match$6[0]),modulus$2=match$6[1];for(s=String.fromCharCode("0123456789".charCodeAt(0|modulus$2[1]))+s;neq(quotient$2,[0,0]);){var match$7=div_mod(quotient$2,wbase$1);quotient$2=match$7[0],modulus$2=match$7[1],s=String.fromCharCode("0123456789".charCodeAt(0|modulus$2[1]))+s}}else{var match$8=div_mod(x$1,wbase$1),quotient$3=match$8[0],modulus$3=match$8[1];for(s=String.fromCharCode("0123456789".charCodeAt(0|modulus$3[1]))+s;neq(quotient$3,[0,0]);){var match$9=div_mod(quotient$3,wbase$1);quotient$3=match$9[0],modulus$3=match$9[1],s=String.fromCharCode("0123456789".charCodeAt(0|modulus$3[1]))+s}}}if(f[9]>=0){f[2]=" ";var n=f[9]-s.length|0;n>0&&(s=repeat(n,"0")+s)}return finish_formatting(f,s)}var caml_nativeint_format=caml_format_int,caml_int32_format=caml_format_int;function caml_create_string(len){if(len<0)throw[invalid_argument,"String.create"];return new Array(len)}function caml_string_compare(s1,s2){return s1===s2?0:s1<s2?-1:1}function caml_blit_string(s1,i1,s2,i2,len){if(len>0){var off1=s1.length-i1|0;if(len<=off1){for(var i=0,i_finish=len-1|0;i<=i_finish;++i)s2[i2+i|0]=s1.charCodeAt(i1+i|0);return 0}for(var i$1=0,i_finish$1=off1-1|0;i$1<=i_finish$1;++i$1)s2[i2+i$1|0]=s1.charCodeAt(i1+i$1|0);for(var i$2=off1,i_finish$2=len-1|0;i$2<=i_finish$2;++i$2)s2[i2+i$2|0]=0;return 0}return 0}function caml_blit_bytes(s1,i1,s2,i2,len){if(len>0){if(s1===s2){var s1$1=s1,i1$1=i1,i2$1=i2,len$1=len;if(i1$1<i2$1){for(var range_a=(s1$1.length-i2$1|0)-1|0,range_b=len$1-1|0,j=range_a>range_b?range_b:range_a;j>=0;--j)s1$1[i2$1+j|0]=s1$1[i1$1+j|0];return 0}if(i1$1>i2$1){for(var range_a$1=(s1$1.length-i1$1|0)-1|0,range_b$1=len$1-1|0,range$1=range_a$1>range_b$1?range_b$1:range_a$1,k=0;k<=range$1;++k)s1$1[i2$1+k|0]=s1$1[i1$1+k|0];return 0}return 0}var off1=s1.length-i1|0;if(len<=off1){for(var i=0,i_finish=len-1|0;i<=i_finish;++i)s2[i2+i|0]=s1[i1+i|0];return 0}for(var i$1=0,i_finish$1=off1-1|0;i$1<=i_finish$1;++i$1)s2[i2+i$1|0]=s1[i1+i$1|0];for(var i$2=off1,i_finish$2=len-1|0;i$2<=i_finish$2;++i$2)s2[i2+i$2|0]=0;return 0}return 0}function bytes_to_string(a){var bytes=a,len=a.length,s="",s_len=len;if(len<=4096&&len===bytes.length)return String.fromCharCode.apply(null,bytes);for(var offset=0;s_len>0;){var next=s_len<1024?s_len:1024,tmp_bytes=new Array(next);caml_blit_bytes(bytes,offset,tmp_bytes,0,next),s+=String.fromCharCode.apply(null,tmp_bytes),s_len=s_len-next|0,offset=offset+next|0}return s}function get(s,i){if(i<0||i>=s.length)throw[invalid_argument,"index out of bounds"];return s.charCodeAt(i)}var id=[0];function create(str){var v=[str,(id[0]+=1,id[0])];return v.tag=248,v}function erase_rel(param){if("number"==typeof param)return 0;switch(0|param.tag){case 0:return __(0,[erase_rel(param[0])]);case 1:return __(1,[erase_rel(param[0])]);case 2:return __(2,[erase_rel(param[0])]);case 3:return __(3,[erase_rel(param[0])]);case 4:return __(4,[erase_rel(param[0])]);case 5:return __(5,[erase_rel(param[0])]);case 6:return __(6,[erase_rel(param[0])]);case 7:return __(7,[erase_rel(param[0])]);case 8:return __(8,[param[0],erase_rel(param[1])]);case 9:var ty1=param[0];return __(9,[ty1,ty1,erase_rel(param[2])]);case 10:return __(10,[erase_rel(param[0])]);case 11:return __(11,[erase_rel(param[0])]);case 12:return __(12,[erase_rel(param[0])]);case 13:return __(13,[erase_rel(param[0])]);case 14:return __(14,[erase_rel(param[0])])}}function concat_fmtty(fmtty1,fmtty2){if("number"==typeof fmtty1)return fmtty2;switch(0|fmtty1.tag){case 0:return __(0,[concat_fmtty(fmtty1[0],fmtty2)]);case 1:return __(1,[concat_fmtty(fmtty1[0],fmtty2)]);case 2:return __(2,[concat_fmtty(fmtty1[0],fmtty2)]);case 3:return __(3,[concat_fmtty(fmtty1[0],fmtty2)]);case 4:return __(4,[concat_fmtty(fmtty1[0],fmtty2)]);case 5:return __(5,[concat_fmtty(fmtty1[0],fmtty2)]);case 6:return __(6,[concat_fmtty(fmtty1[0],fmtty2)]);case 7:return __(7,[concat_fmtty(fmtty1[0],fmtty2)]);case 8:return __(8,[fmtty1[0],concat_fmtty(fmtty1[1],fmtty2)]);case 9:return __(9,[fmtty1[0],fmtty1[1],concat_fmtty(fmtty1[2],fmtty2)]);case 10:return __(10,[concat_fmtty(fmtty1[0],fmtty2)]);case 11:return __(11,[concat_fmtty(fmtty1[0],fmtty2)]);case 12:return __(12,[concat_fmtty(fmtty1[0],fmtty2)]);case 13:return __(13,[concat_fmtty(fmtty1[0],fmtty2)]);case 14:return __(14,[concat_fmtty(fmtty1[0],fmtty2)])}}function concat_fmt(fmt1,fmt2){if("number"==typeof fmt1)return fmt2;switch(0|fmt1.tag){case 0:return __(0,[concat_fmt(fmt1[0],fmt2)]);case 1:return __(1,[concat_fmt(fmt1[0],fmt2)]);case 2:return __(2,[fmt1[0],concat_fmt(fmt1[1],fmt2)]);case 3:return __(3,[fmt1[0],concat_fmt(fmt1[1],fmt2)]);case 4:return __(4,[fmt1[0],fmt1[1],fmt1[2],concat_fmt(fmt1[3],fmt2)]);case 5:return __(5,[fmt1[0],fmt1[1],fmt1[2],concat_fmt(fmt1[3],fmt2)]);case 6:return __(6,[fmt1[0],fmt1[1],fmt1[2],concat_fmt(fmt1[3],fmt2)]);case 7:return __(7,[fmt1[0],fmt1[1],fmt1[2],concat_fmt(fmt1[3],fmt2)]);case 8:return __(8,[fmt1[0],fmt1[1],fmt1[2],concat_fmt(fmt1[3],fmt2)]);case 9:return __(9,[concat_fmt(fmt1[0],fmt2)]);case 10:return __(10,[concat_fmt(fmt1[0],fmt2)]);case 11:return __(11,[fmt1[0],concat_fmt(fmt1[1],fmt2)]);case 12:return __(12,[fmt1[0],concat_fmt(fmt1[1],fmt2)]);case 13:return __(13,[fmt1[0],fmt1[1],concat_fmt(fmt1[2],fmt2)]);case 14:return __(14,[fmt1[0],fmt1[1],concat_fmt(fmt1[2],fmt2)]);case 15:return __(15,[concat_fmt(fmt1[0],fmt2)]);case 16:return __(16,[concat_fmt(fmt1[0],fmt2)]);case 17:return __(17,[fmt1[0],concat_fmt(fmt1[1],fmt2)]);case 18:return __(18,[fmt1[0],concat_fmt(fmt1[1],fmt2)]);case 19:return __(19,[concat_fmt(fmt1[0],fmt2)]);case 20:return __(20,[fmt1[0],fmt1[1],concat_fmt(fmt1[2],fmt2)]);case 21:return __(21,[fmt1[0],concat_fmt(fmt1[1],fmt2)]);case 22:return __(22,[concat_fmt(fmt1[0],fmt2)]);case 23:return __(23,[fmt1[0],concat_fmt(fmt1[1],fmt2)]);case 24:return __(24,[fmt1[0],fmt1[1],concat_fmt(fmt1[2],fmt2)])}}create("Pervasives.Exit");function min(x,y){return+(caml_compare(x,y)<=0)?x:y}function max(x,y){return+(caml_compare(x,y)>=0)?x:y}function abs(x){return x>=0?x:0|-x}function $at(l1,l2){return l1?[l1[0],$at(l1[1],l2)]:l2}function length(l){for(var _len=0,_param=l;;){var param=_param,len=_len;if(!param)return len;_param=param[1],_len=len+1|0}}function rev_append(_l1,_l2){for(;;){var l2=_l2,l1=_l1;if(!l1)return l2;_l2=[l1[0],l2],_l1=l1[1]}}function flatten(param){return param?$at(param[0],flatten(param[1])):0}function map(f,param){if(param){return[_1(f,param[0]),map(f,param[1])]}return 0}function iter(f,_param){for(;;){var param=_param;if(!param)return 0;_1(f,param[0]),_param=param[1]}}function fold_left(f,_accu,_l){for(;;){var l=_l,accu=_accu;if(!l)return accu;_l=l[1],_accu=_2(f,accu,l[0])}}function fold_right(f,l,accu){return l?_2(f,l[0],fold_right(f,l[1],accu)):accu}function mem(x,_param){for(;;){var param=_param;if(param){if(caml_compare(param[0],x)){_param=param[1];continue}return 1}return 0}}function assoc(x,_param){for(;;){var param=_param;if(param){var match=param[0];if(caml_compare(match[0],x)){_param=param[1];continue}return match[1]}throw not_found}}function combine(l1,l2){if(l1){if(l2)return[[l1[0],l2[0]],combine(l1[1],l2[1])];throw[invalid_argument,"List.combine"]}if(l2)throw[invalid_argument,"List.combine"];return 0}var filter=function(p){return function(param){for(var _accu=0,_param=param;;){var param$1=_param,accu=_accu;if(!param$1)return rev_append(accu,0);var l=param$1[1],x=param$1[0];_1(p,x)?(_param=l,_accu=[x,accu]):_param=l}}},match=function(){var match="undefined"==typeof process?void 0:process;return void 0!==match?null==match.argv?["",[""]]:[match.argv[0],match.argv]:["",[""]]}();create("Sys.Break"),match[1],match[0];var $$Error=create("Js_exn.Error");function internalToOCamlException(e){return function(e){if(void 0===e)return 0;if(248===e.tag)return 1;var slot=e[0];return void 0!==slot?+(248===slot.tag):0}(e)?e:[$$Error,e]}function copy(a){var l=a.length;return l?caml_array_sub(a,0,l):[]}function fold_right$1(f,a,x){for(var r=x,i=a.length-1|0;i>=0;--i)r=_2(f,a[i],r);return r}create("Array.Bottom");function make(n,c){var s=caml_create_string(n);return function(s,i,l,c){if(l>0){for(var k=i,k_finish=(l+i|0)-1|0;k<=k_finish;++k)s[k]=c;return 0}}(s,0,n,c),s}function sub_string(b,ofs,len){return bytes_to_string(function(s,ofs,len){if(ofs<0||len<0||ofs>(s.length-len|0))throw[invalid_argument,"String.sub / Bytes.sub"];var r=caml_create_string(len);return caml_blit_bytes(s,ofs,r,0,len),r}(b,ofs,len))}function blit$2(s1,ofs1,s2,ofs2,len){if(len<0||ofs1<0||ofs1>(s1.length-len|0)||ofs2<0||ofs2>(s2.length-len|0))throw[invalid_argument,"Bytes.blit"];return caml_blit_bytes(s1,ofs1,s2,ofs2,len)}function blit_string(s1,ofs1,s2,ofs2,len){if(len<0||ofs1<0||ofs1>(s1.length-len|0)||ofs2<0||ofs2>(s2.length-len|0))throw[invalid_argument,"String.blit / Bytes.blit_string"];return caml_blit_string(s1,ofs1,s2,ofs2,len)}function escaped$1(s){for(var n=0,i=0,i_finish=s.length-1|0;i<=i_finish;++i){var tmp,match=s[i];if(match>=32){var switcher=match-34|0;tmp=switcher>58||switcher<0?switcher>=93?4:1:switcher>57||switcher<1?2:1}else tmp=match>=11?13!==match?4:2:match>=8?2:4;n=n+tmp|0}if(n===s.length)return function(s){var len=s.length,r=caml_create_string(len);return caml_blit_bytes(s,0,r,0,len),r}(s);var s$prime=caml_create_string(n);n=0;for(var i$1=0,i_finish$1=s.length-1|0;i$1<=i_finish$1;++i$1){var c=s[i$1],exit$$1=0;if(c>=35)92!==c?c>=127?exit$$1=1:s$prime[n]=c:exit$$1=2;else if(c>=32)c>=34?exit$$1=2:s$prime[n]=c;else if(c>=14)exit$$1=1;else switch(c){case 8:s$prime[n]=92,s$prime[n=n+1|0]=98;break;case 9:s$prime[n]=92,s$prime[n=n+1|0]=116;break;case 10:s$prime[n]=92,s$prime[n=n+1|0]=110;break;case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 11:case 12:exit$$1=1;break;case 13:s$prime[n]=92,s$prime[n=n+1|0]=114}switch(exit$$1){case 1:s$prime[n]=92,s$prime[n=n+1|0]=48+(c/100|0)|0,s$prime[n=n+1|0]=48+(c/10|0)%10|0,s$prime[n=n+1|0]=48+c%10|0;break;case 2:s$prime[n]=92,s$prime[n=n+1|0]=c}n=n+1|0}return s$prime}function concat$3(sep,l){if(l){var hd$$1=l[0],num=[0],len=[0];iter(function(s){return num[0]=num[0]+1|0,len[0]=len[0]+s.length|0,0},l);var r=caml_create_string(len[0]+imul(sep.length,num[0]-1|0)|0);caml_blit_string(hd$$1,0,r,0,hd$$1.length);var pos=[hd$$1.length];return iter(function(s){return caml_blit_string(sep,0,r,pos[0],sep.length),pos[0]=pos[0]+sep.length|0,caml_blit_string(s,0,r,pos[0],s.length),pos[0]=pos[0]+s.length|0,0},l[1]),bytes_to_string(r)}return""}function escaped$2(s){return function(_i){for(;;){var i=_i;if(i>=s.length)return 0;var match=s.charCodeAt(i);if(!(match>=32))return 1;var switcher=match-34|0;if(switcher>58||switcher<0){if(switcher>=93)return 1;_i=i+1|0}else{if(switcher>57||switcher<1)return 1;_i=i+1|0}}}(0)?bytes_to_string(escaped$1(function(s){for(var len=s.length,res=new Array(len),i=0,i_finish=len-1|0;i<=i_finish;++i)res[i]=s.charCodeAt(i);return res}(s))):s}var blit$3=blit_string;function resize(b,more){for(var new_len=b[2];(b[1]+more|0)>new_len;)new_len<<=1;var new_buffer=caml_create_string(new_len);return blit$2(b[0],0,new_buffer,0,b[1]),b[0]=new_buffer,b[2]=new_len,0}function add_char(b,c){var pos=b[1];return pos>=b[2]&&resize(b,1),b[0][pos]=c,b[1]=pos+1|0,0}function add_string(b,s){var len=s.length,new_position=b[1]+len|0;return new_position>b[2]&&resize(b,len),blit_string(s,0,b[0],b[1],len),b[1]=new_position,0}function buffer_check_size(buf,overhead){var len=buf[1].length,min_len=buf[0]+overhead|0;if(min_len>len){var new_str=caml_create_string(max(len<<1,min_len));return blit$2(buf[1],0,new_str,0,len),buf[1]=new_str,0}return 0}function buffer_add_char(buf,c){return buffer_check_size(buf,1),buf[1][buf[0]]=c,buf[0]=buf[0]+1|0,0}function buffer_add_string(buf,s){var str_len=s.length;return buffer_check_size(buf,str_len),blit$3(s,0,buf[1],buf[0],str_len),buf[0]=buf[0]+str_len|0,0}function buffer_contents(buf){return sub_string(buf[1],0,buf[0])}function string_of_formatting_lit(formatting_lit){if("number"==typeof formatting_lit)switch(formatting_lit){case 0:return"@]";case 1:return"@}";case 2:return"@?";case 3:return"@\n";case 4:return"@.";case 5:return"@@";case 6:return"@%"}else switch(0|formatting_lit.tag){case 0:case 1:return formatting_lit[0];case 2:return"@"+bytes_to_string(make(1,formatting_lit[0]))}}function bprint_fmtty(buf,_fmtty){for(;;){var fmtty=_fmtty;if("number"==typeof fmtty)return 0;switch(0|fmtty.tag){case 0:buffer_add_string(buf,"%c"),_fmtty=fmtty[0];continue;case 1:buffer_add_string(buf,"%s"),_fmtty=fmtty[0];continue;case 2:buffer_add_string(buf,"%i"),_fmtty=fmtty[0];continue;case 3:buffer_add_string(buf,"%li"),_fmtty=fmtty[0];continue;case 4:buffer_add_string(buf,"%ni"),_fmtty=fmtty[0];continue;case 5:buffer_add_string(buf,"%Li"),_fmtty=fmtty[0];continue;case 6:buffer_add_string(buf,"%f"),_fmtty=fmtty[0];continue;case 7:buffer_add_string(buf,"%B"),_fmtty=fmtty[0];continue;case 8:buffer_add_string(buf,"%{"),bprint_fmtty(buf,fmtty[0]),buffer_add_string(buf,"%}"),_fmtty=fmtty[1];continue;case 9:buffer_add_string(buf,"%("),bprint_fmtty(buf,fmtty[0]),buffer_add_string(buf,"%)"),_fmtty=fmtty[2];continue;case 10:buffer_add_string(buf,"%a"),_fmtty=fmtty[0];continue;case 11:buffer_add_string(buf,"%t"),_fmtty=fmtty[0];continue;case 12:buffer_add_string(buf,"%?"),_fmtty=fmtty[0];continue;case 13:buffer_add_string(buf,"%r"),_fmtty=fmtty[0];continue;case 14:buffer_add_string(buf,"%_r"),_fmtty=fmtty[0];continue}}}function symm(param){if("number"==typeof param)return 0;switch(0|param.tag){case 0:return __(0,[symm(param[0])]);case 1:return __(1,[symm(param[0])]);case 2:return __(2,[symm(param[0])]);case 3:return __(3,[symm(param[0])]);case 4:return __(4,[symm(param[0])]);case 5:return __(5,[symm(param[0])]);case 6:return __(6,[symm(param[0])]);case 7:return __(7,[symm(param[0])]);case 8:return __(8,[param[0],symm(param[1])]);case 9:return __(9,[param[1],param[0],symm(param[2])]);case 10:return __(10,[symm(param[0])]);case 11:return __(11,[symm(param[0])]);case 12:return __(12,[symm(param[0])]);case 13:return __(13,[symm(param[0])]);case 14:return __(14,[symm(param[0])])}}function fmtty_rel_det(param){if("number"==typeof param)return[function(){return 0},function(){return 0},function(){return 0},function(){return 0}];switch(0|param.tag){case 0:var match=fmtty_rel_det(param[0]),af=match[1],fa=match[0];return[function(){return _1(fa,0),0},function(){return _1(af,0),0},match[2],match[3]];case 1:var match$1=fmtty_rel_det(param[0]),af$1=match$1[1],fa$1=match$1[0];return[function(){return _1(fa$1,0),0},function(){return _1(af$1,0),0},match$1[2],match$1[3]];case 2:var match$2=fmtty_rel_det(param[0]),af$2=match$2[1],fa$2=match$2[0];return[function(){return _1(fa$2,0),0},function(){return _1(af$2,0),0},match$2[2],match$2[3]];case 3:var match$3=fmtty_rel_det(param[0]),af$3=match$3[1],fa$3=match$3[0];return[function(){return _1(fa$3,0),0},function(){return _1(af$3,0),0},match$3[2],match$3[3]];case 4:var match$4=fmtty_rel_det(param[0]),af$4=match$4[1],fa$4=match$4[0];return[function(){return _1(fa$4,0),0},function(){return _1(af$4,0),0},match$4[2],match$4[3]];case 5:var match$5=fmtty_rel_det(param[0]),af$5=match$5[1],fa$5=match$5[0];return[function(){return _1(fa$5,0),0},function(){return _1(af$5,0),0},match$5[2],match$5[3]];case 6:var match$6=fmtty_rel_det(param[0]),af$6=match$6[1],fa$6=match$6[0];return[function(){return _1(fa$6,0),0},function(){return _1(af$6,0),0},match$6[2],match$6[3]];case 7:var match$7=fmtty_rel_det(param[0]),af$7=match$7[1],fa$7=match$7[0];return[function(){return _1(fa$7,0),0},function(){return _1(af$7,0),0},match$7[2],match$7[3]];case 8:var match$8=fmtty_rel_det(param[1]),af$8=match$8[1],fa$8=match$8[0];return[function(){return _1(fa$8,0),0},function(){return _1(af$8,0),0},match$8[2],match$8[3]];case 9:var match$9=fmtty_rel_det(param[2]),de=match$9[3],ed=match$9[2],af$9=match$9[1],fa$9=match$9[0],match$10=fmtty_rel_det(trans(symm(param[0]),param[1])),jd=match$10[3],dj=match$10[2],ga=match$10[1],ag=match$10[0];return[function(){return _1(fa$9,0),_1(ag,0),0},function(){return _1(ga,0),_1(af$9,0),0},function(){return _1(ed,0),_1(dj,0),0},function(){return _1(jd,0),_1(de,0),0}];case 10:var match$11=fmtty_rel_det(param[0]),af$10=match$11[1],fa$10=match$11[0];return[function(){return _1(fa$10,0),0},function(){return _1(af$10,0),0},match$11[2],match$11[3]];case 11:var match$12=fmtty_rel_det(param[0]),af$11=match$12[1],fa$11=match$12[0];return[function(){return _1(fa$11,0),0},function(){return _1(af$11,0),0},match$12[2],match$12[3]];case 12:var match$13=fmtty_rel_det(param[0]),af$12=match$13[1],fa$12=match$13[0];return[function(){return _1(fa$12,0),0},function(){return _1(af$12,0),0},match$13[2],match$13[3]];case 13:var match$14=fmtty_rel_det(param[0]),de$1=match$14[3],ed$1=match$14[2],af$13=match$14[1],fa$13=match$14[0];return[function(){return _1(fa$13,0),0},function(){return _1(af$13,0),0},function(){return _1(ed$1,0),0},function(){return _1(de$1,0),0}];case 14:var match$15=fmtty_rel_det(param[0]),de$2=match$15[3],ed$2=match$15[2],af$14=match$15[1],fa$14=match$15[0];return[function(){return _1(fa$14,0),0},function(){return _1(af$14,0),0},function(){return _1(ed$2,0),0},function(){return _1(de$2,0),0}]}}function trans(ty1,ty2){var exit$$1=0;if("number"==typeof ty1){if("number"==typeof ty2)return 0;switch(0|ty2.tag){case 8:exit$$1=6;break;case 9:exit$$1=7;break;case 10:exit$$1=1;break;case 11:exit$$1=2;break;case 12:exit$$1=3;break;case 13:exit$$1=4;break;case 14:exit$$1=5;break;default:throw[assert_failure,["camlinternalFormat.ml",816,23]]}}else switch(0|ty1.tag){case 0:if("number"==typeof ty2)exit$$1=8;else switch(0|ty2.tag){case 0:return __(0,[trans(ty1[0],ty2[0])]);case 8:exit$$1=6;break;case 9:exit$$1=7;break;case 10:exit$$1=1;break;case 11:exit$$1=2;break;case 12:exit$$1=3;break;case 13:exit$$1=4;break;case 14:exit$$1=5}break;case 1:if("number"==typeof ty2)exit$$1=8;else switch(0|ty2.tag){case 1:return __(1,[trans(ty1[0],ty2[0])]);case 8:exit$$1=6;break;case 9:exit$$1=7;break;case 10:exit$$1=1;break;case 11:exit$$1=2;break;case 12:exit$$1=3;break;case 13:exit$$1=4;break;case 14:exit$$1=5}break;case 2:if("number"==typeof ty2)exit$$1=8;else switch(0|ty2.tag){case 2:return __(2,[trans(ty1[0],ty2[0])]);case 8:exit$$1=6;break;case 9:exit$$1=7;break;case 10:exit$$1=1;break;case 11:exit$$1=2;break;case 12:exit$$1=3;break;case 13:exit$$1=4;break;case 14:exit$$1=5}break;case 3:if("number"==typeof ty2)exit$$1=8;else switch(0|ty2.tag){case 3:return __(3,[trans(ty1[0],ty2[0])]);case 8:exit$$1=6;break;case 9:exit$$1=7;break;case 10:exit$$1=1;break;case 11:exit$$1=2;break;case 12:exit$$1=3;break;case 13:exit$$1=4;break;case 14:exit$$1=5}break;case 4:if("number"==typeof ty2)exit$$1=8;else switch(0|ty2.tag){case 4:return __(4,[trans(ty1[0],ty2[0])]);case 8:exit$$1=6;break;case 9:exit$$1=7;break;case 10:exit$$1=1;break;case 11:exit$$1=2;break;case 12:exit$$1=3;break;case 13:exit$$1=4;break;case 14:exit$$1=5}break;case 5:if("number"==typeof ty2)exit$$1=8;else switch(0|ty2.tag){case 5:return __(5,[trans(ty1[0],ty2[0])]);case 8:exit$$1=6;break;case 9:exit$$1=7;break;case 10:exit$$1=1;break;case 11:exit$$1=2;break;case 12:exit$$1=3;break;case 13:exit$$1=4;break;case 14:exit$$1=5}break;case 6:if("number"==typeof ty2)exit$$1=8;else switch(0|ty2.tag){case 6:return __(6,[trans(ty1[0],ty2[0])]);case 8:exit$$1=6;break;case 9:exit$$1=7;break;case 10:exit$$1=1;break;case 11:exit$$1=2;break;case 12:exit$$1=3;break;case 13:exit$$1=4;break;case 14:exit$$1=5}break;case 7:if("number"==typeof ty2)exit$$1=8;else switch(0|ty2.tag){case 7:return __(7,[trans(ty1[0],ty2[0])]);case 8:exit$$1=6;break;case 9:exit$$1=7;break;case 10:exit$$1=1;break;case 11:exit$$1=2;break;case 12:exit$$1=3;break;case 13:exit$$1=4;break;case 14:exit$$1=5}break;case 8:if("number"==typeof ty2)throw[assert_failure,["camlinternalFormat.ml",802,26]];switch(0|ty2.tag){case 8:return __(8,[trans(ty1[0],ty2[0]),trans(ty1[1],ty2[1])]);case 10:exit$$1=1;break;case 11:exit$$1=2;break;case 12:exit$$1=3;break;case 13:exit$$1=4;break;case 14:exit$$1=5;break;default:throw[assert_failure,["camlinternalFormat.ml",802,26]]}break;case 9:if("number"==typeof ty2)throw[assert_failure,["camlinternalFormat.ml",812,28]];switch(0|ty2.tag){case 8:exit$$1=6;break;case 9:var match=fmtty_rel_det(trans(symm(ty1[1]),ty2[0]));return _1(match[1],0),_1(match[3],0),__(9,[ty1[0],ty2[1],trans(ty1[2],ty2[2])]);case 10:exit$$1=1;break;case 11:exit$$1=2;break;case 12:exit$$1=3;break;case 13:exit$$1=4;break;case 14:exit$$1=5;break;default:throw[assert_failure,["camlinternalFormat.ml",812,28]]}break;case 10:if("number"==typeof ty2)throw[assert_failure,["camlinternalFormat.ml",780,21]];if(10===ty2.tag)return __(10,[trans(ty1[0],ty2[0])]);throw[assert_failure,["camlinternalFormat.ml",780,21]];case 11:if("number"==typeof ty2)throw[assert_failure,["camlinternalFormat.ml",784,21]];switch(0|ty2.tag){case 10:exit$$1=1;break;case 11:return __(11,[trans(ty1[0],ty2[0])]);default:throw[assert_failure,["camlinternalFormat.ml",784,21]]}break;case 12:if("number"==typeof ty2)throw[assert_failure,["camlinternalFormat.ml",788,19]];switch(0|ty2.tag){case 10:exit$$1=1;break;case 11:exit$$1=2;break;case 12:return __(12,[trans(ty1[0],ty2[0])]);default:throw[assert_failure,["camlinternalFormat.ml",788,19]]}break;case 13:if("number"==typeof ty2)throw[assert_failure,["camlinternalFormat.ml",792,22]];switch(0|ty2.tag){case 10:exit$$1=1;break;case 11:exit$$1=2;break;case 12:exit$$1=3;break;case 13:return __(13,[trans(ty1[0],ty2[0])]);default:throw[assert_failure,["camlinternalFormat.ml",792,22]]}break;case 14:if("number"==typeof ty2)throw[assert_failure,["camlinternalFormat.ml",797,30]];switch(0|ty2.tag){case 10:exit$$1=1;break;case 11:exit$$1=2;break;case 12:exit$$1=3;break;case 13:exit$$1=4;break;case 14:return __(14,[trans(ty1[0],ty2[0])]);default:throw[assert_failure,["camlinternalFormat.ml",797,30]]}}switch(exit$$1){case 1:throw[assert_failure,["camlinternalFormat.ml",781,21]];case 2:throw[assert_failure,["camlinternalFormat.ml",785,21]];case 3:throw[assert_failure,["camlinternalFormat.ml",789,19]];case 4:throw[assert_failure,["camlinternalFormat.ml",793,22]];case 5:throw[assert_failure,["camlinternalFormat.ml",798,30]];case 6:throw[assert_failure,["camlinternalFormat.ml",803,26]];case 7:throw[assert_failure,["camlinternalFormat.ml",813,28]];case 8:throw[assert_failure,["camlinternalFormat.ml",817,23]]}}var Type_mismatch=create("CamlinternalFormat.Type_mismatch");function type_padding(pad,fmtty){if("number"==typeof pad)return[0,fmtty];if(pad.tag){if("number"==typeof fmtty)throw Type_mismatch;if(2===fmtty.tag)return[__(1,[pad[0]]),fmtty[0]];throw Type_mismatch}return[__(0,[pad[0],pad[1]]),fmtty]}function type_padprec(pad,prec,fmtty){var match=type_padding(pad,fmtty);if("number"==typeof prec){if(0!==prec){var match$1=match[1];if("number"==typeof match$1)throw Type_mismatch;if(2===match$1.tag)return[match[0],1,match$1[0]];throw Type_mismatch}return[match[0],0,match[1]]}return[match[0],[prec[0]],match[1]]}function type_ignored_param_one(ign,fmt,fmtty){var match=type_format_gen(fmt,fmtty);return[__(23,[ign,match[0]]),match[1]]}function type_format_gen(fmt,fmtty){if("number"==typeof fmt)return[0,fmtty];switch(0|fmt.tag){case 0:if("number"==typeof fmtty)throw Type_mismatch;if(fmtty.tag)throw Type_mismatch;var match=type_format_gen(fmt[0],fmtty[0]);return[__(0,[match[0]]),match[1]];case 1:if("number"==typeof fmtty)throw Type_mismatch;if(fmtty.tag)throw Type_mismatch;var match$1=type_format_gen(fmt[0],fmtty[0]);return[__(1,[match$1[0]]),match$1[1]];case 2:var match$2=type_padding(fmt[0],fmtty),match$3=match$2[1];if("number"==typeof match$3)throw Type_mismatch;if(1===match$3.tag){var match$4=type_format_gen(fmt[1],match$3[0]);return[__(2,[match$2[0],match$4[0]]),match$4[1]]}throw Type_mismatch;case 3:var match$5=type_padding(fmt[0],fmtty),match$6=match$5[1];if("number"==typeof match$6)throw Type_mismatch;if(1===match$6.tag){var match$7=type_format_gen(fmt[1],match$6[0]);return[__(3,[match$5[0],match$7[0]]),match$7[1]]}throw Type_mismatch;case 4:var match$8=type_padprec(fmt[1],fmt[2],fmtty),match$9=match$8[2];if("number"==typeof match$9)throw Type_mismatch;if(2===match$9.tag){var match$10=type_format_gen(fmt[3],match$9[0]);return[__(4,[fmt[0],match$8[0],match$8[1],match$10[0]]),match$10[1]]}throw Type_mismatch;case 5:var match$11=type_padprec(fmt[1],fmt[2],fmtty),match$12=match$11[2];if("number"==typeof match$12)throw Type_mismatch;if(3===match$12.tag){var match$13=type_format_gen(fmt[3],match$12[0]);return[__(5,[fmt[0],match$11[0],match$11[1],match$13[0]]),match$13[1]]}throw Type_mismatch;case 6:var match$14=type_padprec(fmt[1],fmt[2],fmtty),match$15=match$14[2];if("number"==typeof match$15)throw Type_mismatch;if(4===match$15.tag){var match$16=type_format_gen(fmt[3],match$15[0]);return[__(6,[fmt[0],match$14[0],match$14[1],match$16[0]]),match$16[1]]}throw Type_mismatch;case 7:var match$17=type_padprec(fmt[1],fmt[2],fmtty),match$18=match$17[2];if("number"==typeof match$18)throw Type_mismatch;if(5===match$18.tag){var match$19=type_format_gen(fmt[3],match$18[0]);return[__(7,[fmt[0],match$17[0],match$17[1],match$19[0]]),match$19[1]]}throw Type_mismatch;case 8:var match$20=type_padprec(fmt[1],fmt[2],fmtty),match$21=match$20[2];if("number"==typeof match$21)throw Type_mismatch;if(6===match$21.tag){var match$22=type_format_gen(fmt[3],match$21[0]);return[__(8,[fmt[0],match$20[0],match$20[1],match$22[0]]),match$22[1]]}throw Type_mismatch;case 9:if("number"==typeof fmtty)throw Type_mismatch;if(7===fmtty.tag){var match$23=type_format_gen(fmt[0],fmtty[0]);return[__(9,[match$23[0]]),match$23[1]]}throw Type_mismatch;case 10:var match$24=type_format_gen(fmt[0],fmtty);return[__(10,[match$24[0]]),match$24[1]];case 11:var match$25=type_format_gen(fmt[1],fmtty);return[__(11,[fmt[0],match$25[0]]),match$25[1]];case 12:var match$26=type_format_gen(fmt[1],fmtty);return[__(12,[fmt[0],match$26[0]]),match$26[1]];case 13:if("number"==typeof fmtty)throw Type_mismatch;if(8===fmtty.tag){var sub_fmtty$prime=fmtty[0];if(caml_notequal([fmt[1]],[sub_fmtty$prime]))throw Type_mismatch;var match$27=type_format_gen(fmt[2],fmtty[1]);return[__(13,[fmt[0],sub_fmtty$prime,match$27[0]]),match$27[1]]}throw Type_mismatch;case 14:if("number"==typeof fmtty)throw Type_mismatch;if(9===fmtty.tag){var sub_fmtty1=fmtty[0];if(caml_notequal([erase_rel(fmt[1])],[erase_rel(sub_fmtty1)]))throw Type_mismatch;var match$28=type_format_gen(fmt[2],erase_rel(fmtty[2]));return[__(14,[fmt[0],sub_fmtty1,match$28[0]]),match$28[1]]}throw Type_mismatch;case 15:if("number"==typeof fmtty)throw Type_mismatch;if(10===fmtty.tag){var match$29=type_format_gen(fmt[0],fmtty[0]);return[__(15,[match$29[0]]),match$29[1]]}throw Type_mismatch;case 16:if("number"==typeof fmtty)throw Type_mismatch;if(11===fmtty.tag){var match$30=type_format_gen(fmt[0],fmtty[0]);return[__(16,[match$30[0]]),match$30[1]]}throw Type_mismatch;case 17:var match$31=type_format_gen(fmt[1],fmtty);return[__(17,[fmt[0],match$31[0]]),match$31[1]];case 18:var formatting_gen=fmt[0],fmt0=fmt[1],fmtty0=fmtty;if(formatting_gen.tag){var match$32=formatting_gen[0],match$33=type_format_gen(match$32[0],fmtty0),match$34=type_format_gen(fmt0,match$33[1]);return[__(18,[__(1,[[match$33[0],match$32[1]]]),match$34[0]]),match$34[1]]}var match$35=formatting_gen[0],match$36=type_format_gen(match$35[0],fmtty0),match$37=type_format_gen(fmt0,match$36[1]);return[__(18,[__(0,[[match$36[0],match$35[1]]]),match$37[0]]),match$37[1]];case 19:if("number"==typeof fmtty)throw Type_mismatch;if(13===fmtty.tag){var match$38=type_format_gen(fmt[0],fmtty[0]);return[__(19,[match$38[0]]),match$38[1]]}throw Type_mismatch;case 20:if("number"==typeof fmtty)throw Type_mismatch;if(1===fmtty.tag){var match$39=type_format_gen(fmt[2],fmtty[0]);return[__(20,[fmt[0],fmt[1],match$39[0]]),match$39[1]]}throw Type_mismatch;case 21:if("number"==typeof fmtty)throw Type_mismatch;if(2===fmtty.tag){var match$40=type_format_gen(fmt[1],fmtty[0]);return[__(21,[fmt[0],match$40[0]]),match$40[1]]}throw Type_mismatch;case 23:var ign=fmt[0],fmt$1=fmt[1],fmtty$1=fmtty;if("number"==typeof ign){if(3===ign){if("number"==typeof fmtty$1)throw Type_mismatch;if(14===fmtty$1.tag){var match$41=type_format_gen(fmt$1,fmtty$1[0]);return[__(23,[3,match$41[0]]),match$41[1]]}throw Type_mismatch}return type_ignored_param_one(ign,fmt$1,fmtty$1)}switch(0|ign.tag){case 7:return type_ignored_param_one(__(7,[ign[0],ign[1]]),fmt$1,fmtty$1);case 8:var match$42=type_ignored_format_substitution(ign[1],fmt$1,fmtty$1),match$43=match$42[1];return[__(23,[__(8,[ign[0],match$42[0]]),match$43[0]]),match$43[1]];default:return type_ignored_param_one(ign,fmt$1,fmtty$1)}case 22:case 24:throw Type_mismatch}}function type_ignored_format_substitution(sub_fmtty,fmt,fmtty){if("number"==typeof sub_fmtty)return[0,type_format_gen(fmt,fmtty)];switch(0|sub_fmtty.tag){case 0:if("number"==typeof fmtty)throw Type_mismatch;if(fmtty.tag)throw Type_mismatch;var match=type_ignored_format_substitution(sub_fmtty[0],fmt,fmtty[0]);return[__(0,[match[0]]),match[1]];case 1:if("number"==typeof fmtty)throw Type_mismatch;if(1===fmtty.tag){var match$1=type_ignored_format_substitution(sub_fmtty[0],fmt,fmtty[0]);return[__(1,[match$1[0]]),match$1[1]]}throw Type_mismatch;case 2:if("number"==typeof fmtty)throw Type_mismatch;if(2===fmtty.tag){var match$2=type_ignored_format_substitution(sub_fmtty[0],fmt,fmtty[0]);return[__(2,[match$2[0]]),match$2[1]]}throw Type_mismatch;case 3:if("number"==typeof fmtty)throw Type_mismatch;if(3===fmtty.tag){var match$3=type_ignored_format_substitution(sub_fmtty[0],fmt,fmtty[0]);return[__(3,[match$3[0]]),match$3[1]]}throw Type_mismatch;case 4:if("number"==typeof fmtty)throw Type_mismatch;if(4===fmtty.tag){var match$4=type_ignored_format_substitution(sub_fmtty[0],fmt,fmtty[0]);return[__(4,[match$4[0]]),match$4[1]]}throw Type_mismatch;case 5:if("number"==typeof fmtty)throw Type_mismatch;if(5===fmtty.tag){var match$5=type_ignored_format_substitution(sub_fmtty[0],fmt,fmtty[0]);return[__(5,[match$5[0]]),match$5[1]]}throw Type_mismatch;case 6:if("number"==typeof fmtty)throw Type_mismatch;if(6===fmtty.tag){var match$6=type_ignored_format_substitution(sub_fmtty[0],fmt,fmtty[0]);return[__(6,[match$6[0]]),match$6[1]]}throw Type_mismatch;case 7:if("number"==typeof fmtty)throw Type_mismatch;if(7===fmtty.tag){var match$7=type_ignored_format_substitution(sub_fmtty[0],fmt,fmtty[0]);return[__(7,[match$7[0]]),match$7[1]]}throw Type_mismatch;case 8:if("number"==typeof fmtty)throw Type_mismatch;if(8===fmtty.tag){var sub2_fmtty$prime=fmtty[0];if(caml_notequal([sub_fmtty[0]],[sub2_fmtty$prime]))throw Type_mismatch;var match$8=type_ignored_format_substitution(sub_fmtty[1],fmt,fmtty[1]);return[__(8,[sub2_fmtty$prime,match$8[0]]),match$8[1]]}throw Type_mismatch;case 9:if("number"==typeof fmtty)throw Type_mismatch;if(9===fmtty.tag){var sub2_fmtty$prime$1=fmtty[1],sub1_fmtty$prime=fmtty[0];if(caml_notequal([erase_rel(sub_fmtty[0])],[erase_rel(sub1_fmtty$prime)]))throw Type_mismatch;if(caml_notequal([erase_rel(sub_fmtty[1])],[erase_rel(sub2_fmtty$prime$1)]))throw Type_mismatch;var match$9=fmtty_rel_det(trans(symm(sub1_fmtty$prime),sub2_fmtty$prime$1));_1(match$9[1],0),_1(match$9[3],0);var match$10=type_ignored_format_substitution(erase_rel(sub_fmtty[2]),fmt,fmtty[2]);return[__(9,[sub1_fmtty$prime,sub2_fmtty$prime$1,symm(match$10[0])]),match$10[1]]}throw Type_mismatch;case 10:if("number"==typeof fmtty)throw Type_mismatch;if(10===fmtty.tag){var match$11=type_ignored_format_substitution(sub_fmtty[0],fmt,fmtty[0]);return[__(10,[match$11[0]]),match$11[1]]}throw Type_mismatch;case 11:if("number"==typeof fmtty)throw Type_mismatch;if(11===fmtty.tag){var match$12=type_ignored_format_substitution(sub_fmtty[0],fmt,fmtty[0]);return[__(11,[match$12[0]]),match$12[1]]}throw Type_mismatch;case 12:throw Type_mismatch;case 13:if("number"==typeof fmtty)throw Type_mismatch;if(13===fmtty.tag){var match$13=type_ignored_format_substitution(sub_fmtty[0],fmt,fmtty[0]);return[__(13,[match$13[0]]),match$13[1]]}throw Type_mismatch;case 14:if("number"==typeof fmtty)throw Type_mismatch;if(14===fmtty.tag){var match$14=type_ignored_format_substitution(sub_fmtty[0],fmt,fmtty[0]);return[__(14,[match$14[0]]),match$14[1]]}throw Type_mismatch}}function recast(fmt,fmtty){return function(fmt,fmtty){var match=type_format_gen(fmt,fmtty);if("number"==typeof match[1])return match[0];throw Type_mismatch}(fmt,erase_rel(symm(fmtty)))}function fix_padding(padty,width,str){var len=str.length,match_000=abs(width),match_001=width<0?0:padty,width$1=match_000;if(width$1<=len)return str;var padty$1=match_001,res=make(width$1,2===padty$1?48:32);switch(padty$1){case 0:blit$3(str,0,res,0,len);break;case 1:blit$3(str,0,res,width$1-len|0,len);break;case 2:len>0&&(43===get(str,0)||45===get(str,0)||32===get(str,0))?(res[0]=get(str,0),blit$3(str,1,res,1+(width$1-len|0)|0,len-1|0)):len>1&&48===get(str,0)&&(120===get(str,1)||88===get(str,1))?(res[1]=get(str,1),blit$3(str,2,res,2+(width$1-len|0)|0,len-2|0)):blit$3(str,0,res,width$1-len|0,len)}return bytes_to_string(res)}function fix_int_precision(prec,str){var prec$1=abs(prec),len=str.length,c=get(str,0),exit$$1=0;if(c>=58)if(c>=71){if(c>102||c<97)return str;exit$$1=2}else{if(!(c>=65))return str;exit$$1=2}else if(32!==c){if(!(c>=43))return str;switch(c-43|0){case 0:case 2:exit$$1=1;break;case 1:case 3:case 4:return str;case 5:if((prec$1+2|0)>len&&len>1&&(120===get(str,1)||88===get(str,1))){var res=make(prec$1+2|0,48);return res[1]=get(str,1),blit$3(str,2,res,4+(prec$1-len|0)|0,len-2|0),bytes_to_string(res)}exit$$1=2;break;case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:exit$$1=2}}else exit$$1=1;switch(exit$$1){case 1:if((prec$1+1|0)>len){var res$1=make(prec$1+1|0,48);return res$1[0]=c,blit$3(str,1,res$1,2+(prec$1-len|0)|0,len-1|0),bytes_to_string(res$1)}return str;case 2:if(prec$1>len){var res$2=make(prec$1,48);return blit$3(str,0,res$2,prec$1-len|0,len),bytes_to_string(res$2)}return str}}function string_to_caml_string(str){return concat$3(escaped$2(str),['"',['"',0]])}function format_of_aconv(iconv,c){var seps;switch(iconv){case 0:seps=["%",["d",0]];break;case 1:seps=["%+",["d",0]];break;case 2:seps=["% ",["d",0]];break;case 3:seps=["%",["i",0]];break;case 4:seps=["%+",["i",0]];break;case 5:seps=["% ",["i",0]];break;case 6:seps=["%",["x",0]];break;case 7:seps=["%#",["x",0]];break;case 8:seps=["%",["X",0]];break;case 9:seps=["%#",["X",0]];break;case 10:seps=["%",["o",0]];break;case 11:seps=["%#",["o",0]];break;case 12:seps=["%",["u",0]]}return concat$3(bytes_to_string(make(1,c)),seps)}function format_of_fconv(fconv,prec){if(15===fconv)return"%.12g";var prec$1=abs(prec),symb=function(fconv){switch(fconv){case 0:case 1:case 2:return 102;case 3:case 4:case 5:return 101;case 6:case 7:case 8:return 69;case 9:case 10:case 11:return 103;case 12:case 13:case 14:return 71;case 15:return 70}}(fconv),buf=[0,new Array(16)];return buffer_add_char(buf,37),function(buf,fconv){switch(fconv){case 1:case 4:case 7:case 10:case 13:return buffer_add_char(buf,43);case 2:case 5:case 8:case 11:case 14:return buffer_add_char(buf,32);case 0:case 3:case 6:case 9:case 12:case 15:;}}(buf,fconv),buffer_add_char(buf,46),buffer_add_string(buf,""+prec$1),buffer_add_char(buf,symb),buffer_contents(buf)}function convert_int(iconv,n){return caml_format_int(function(iconv){switch(iconv){case 0:return"%d";case 1:return"%+d";case 2:return"% d";case 3:return"%i";case 4:return"%+i";case 5:return"% i";case 6:return"%x";case 7:return"%#x";case 8:return"%X";case 9:return"%#X";case 10:return"%o";case 11:return"%#o";case 12:return"%u"}}(iconv),n)}function convert_int32(iconv,n){return caml_int32_format(format_of_aconv(iconv,108),n)}function convert_nativeint(iconv,n){return caml_nativeint_format(format_of_aconv(iconv,110),n)}function convert_int64(iconv,n){return caml_int64_format(format_of_aconv(iconv,76),n)}function convert_float(fconv,prec,x){var str=function(fmt,x){var f=parse_format(fmt),prec=f[9]<0?6:f[9],x$1=x<0?(f[8]=-1,-x):x,s="";if(isNaN(x$1))s="nan",f[2]=" ";else if(isFinite(x$1))switch(f[10]){case"e":var i=(s=x$1.toExponential(prec)).length;"e"===s[i-3|0]&&(s=s.slice(0,i-1|0)+"0"+s.slice(i-1|0));break;case"f":s=x$1.toFixed(prec);break;case"g":var prec$1=0!==prec?prec:1,j=(s=x$1.toExponential(prec$1-1|0)).indexOf("e"),exp=0|Number(s.slice(j+1|0));if(exp<-4||x$1>=1e21||x$1.toFixed().length>prec$1){for(var i$1=j-1|0;"0"===s[i$1];)i$1=i$1-1|0;"."===s[i$1]&&(i$1=i$1-1|0);var i$2=(s=s.slice(0,i$1+1|0)+s.slice(j)).length;"e"===s[i$2-3|0]&&(s=s.slice(0,i$2-1|0)+"0"+s.slice(i$2-1|0))}else{var p=prec$1;if(exp<0)p=p-(exp+1|0)|0,s=x$1.toFixed(p);else for(;+((s=x$1.toFixed(p)).length>(prec$1+1|0));)p=p-1|0;if(0!==p){for(var k=s.length-1|0;"0"===s[k];)k=k-1|0;"."===s[k]&&(k=k-1|0),s=s.slice(0,k+1|0)}}}else s="inf",f[2]=" ";return finish_formatting(f,s)}(format_of_fconv(fconv,abs(prec)),x);if(15!==fconv)return str;var len=str.length,match=function(x){return isFinite(x)?Math.abs(x)>=2.2250738585072014e-308?0:0!==x?1:2:isNaN(x)?4:3}(x);return 3!==match?match>=4?"nan":function(_i){for(;;){var i=_i;if(i===len)return 0;var switcher=get(str,i)-46|0;if(switcher>23||switcher<0){if(55!==switcher){_i=i+1|0;continue}return 1}if(switcher>22||switcher<1)return 1;_i=i+1|0}}(0)?str:str+".":x<0?"neg_infinity":"infinity"}function format_caml_char(c){return concat$3(function(c){var exit=0;if(c>=40){if(92===c)return"\\\\";exit=c>=127?1:2}else if(c>=32){if(c>=39)return"\\'";exit=2}else if(c>=14)exit=1;else switch(c){case 8:return"\\b";case 9:return"\\t";case 10:return"\\n";case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 11:case 12:exit=1;break;case 13:return"\\r"}switch(exit){case 1:var s=new Array(4);return s[0]=92,s[1]=48+(c/100|0)|0,s[2]=48+(c/10|0)%10|0,s[3]=48+c%10|0,bytes_to_string(s);case 2:var s$1=new Array(1);return s$1[0]=c,bytes_to_string(s$1)}}(c),["'",["'",0]])}function string_of_fmtty(fmtty){var buf=[0,new Array(16)];return bprint_fmtty(buf,fmtty),buffer_contents(buf)}function make_printf(_k,o,_acc,_fmt){for(;;){var fmt=_fmt,acc=_acc,k=_k;if("number"==typeof fmt)return _2(k,o,acc);switch(0|fmt.tag){case 0:return function(k,acc,rest){return function(c){var new_acc=__(5,[acc,c]);return make_printf(k,o,new_acc,rest)}}(k,acc,fmt[0]);case 1:return function(k,acc,rest$1){return function(c){var new_acc_001=format_caml_char(c),new_acc=__(4,[acc,new_acc_001]);return make_printf(k,o,new_acc,rest$1)}}(k,acc,fmt[0]);case 2:return make_string_padding(k,o,acc,fmt[1],fmt[0],function(str){return str});case 3:return make_string_padding(k,o,acc,fmt[1],fmt[0],string_to_caml_string);case 4:return make_int_padding_precision(k,o,acc,fmt[3],fmt[1],fmt[2],convert_int,fmt[0]);case 5:return make_int_padding_precision(k,o,acc,fmt[3],fmt[1],fmt[2],convert_int32,fmt[0]);case 6:return make_int_padding_precision(k,o,acc,fmt[3],fmt[1],fmt[2],convert_nativeint,fmt[0]);case 7:return make_int_padding_precision(k,o,acc,fmt[3],fmt[1],fmt[2],convert_int64,fmt[0]);case 8:var k$1=k,o$1=o,acc$1=acc,fmt$1=fmt[3],pad=fmt[1],prec=fmt[2],fconv=fmt[0];if("number"==typeof pad){if("number"==typeof prec)return 0!==prec?function(k$1,o$1,acc$1,fmt$1,fconv){return function(p,x){var str=convert_float(fconv,p,x);return make_printf(k$1,o$1,__(4,[acc$1,str]),fmt$1)}}(k$1,o$1,acc$1,fmt$1,fconv):function(k$1,o$1,acc$1,fmt$1,fconv){return function(x){var str=convert_float(fconv,6,x);return make_printf(k$1,o$1,__(4,[acc$1,str]),fmt$1)}}(k$1,o$1,acc$1,fmt$1,fconv);return function(k$1,o$1,acc$1,fmt$1,fconv,p){return function(x){var str=convert_float(fconv,p,x);return make_printf(k$1,o$1,__(4,[acc$1,str]),fmt$1)}}(k$1,o$1,acc$1,fmt$1,fconv,prec[0])}if(pad.tag){var padty=pad[0];if("number"==typeof prec)return 0!==prec?function(k$1,o$1,acc$1,fmt$1,fconv,padty){return function(w,p,x){var str=fix_padding(padty,w,convert_float(fconv,p,x));return make_printf(k$1,o$1,__(4,[acc$1,str]),fmt$1)}}(k$1,o$1,acc$1,fmt$1,fconv,padty):function(k$1,o$1,acc$1,fmt$1,fconv,padty){return function(w,x){var str=convert_float(fconv,6,x),str$prime=fix_padding(padty,w,str);return make_printf(k$1,o$1,__(4,[acc$1,str$prime]),fmt$1)}}(k$1,o$1,acc$1,fmt$1,fconv,padty);return function(k$1,o$1,acc$1,fmt$1,fconv,padty,p$1){return function(w,x){var str=fix_padding(padty,w,convert_float(fconv,p$1,x));return make_printf(k$1,o$1,__(4,[acc$1,str]),fmt$1)}}(k$1,o$1,acc$1,fmt$1,fconv,padty,prec[0])}var w=pad[1],padty$1=pad[0];if("number"==typeof prec)return 0!==prec?function(k$1,o$1,acc$1,fmt$1,fconv,padty$1,w){return function(p,x){var str=fix_padding(padty$1,w,convert_float(fconv,p,x));return make_printf(k$1,o$1,__(4,[acc$1,str]),fmt$1)}}(k$1,o$1,acc$1,fmt$1,fconv,padty$1,w):function(k$1,o$1,acc$1,fmt$1,fconv,padty$1,w){return function(x){var str=convert_float(fconv,6,x),str$prime=fix_padding(padty$1,w,str);return make_printf(k$1,o$1,__(4,[acc$1,str$prime]),fmt$1)}}(k$1,o$1,acc$1,fmt$1,fconv,padty$1,w);return function(k$1,o$1,acc$1,fmt$1,fconv,padty$1,w,p$2){return function(x){var str=fix_padding(padty$1,w,convert_float(fconv,p$2,x));return make_printf(k$1,o$1,__(4,[acc$1,str]),fmt$1)}}(k$1,o$1,acc$1,fmt$1,fconv,padty$1,w,prec[0]);case 9:return function(k,acc,rest$2){return function(b){return make_printf(k,o,__(4,[acc,b?"true":"false"]),rest$2)}}(k,acc,fmt[0]);case 10:_fmt=fmt[0],_acc=__(7,[acc]);continue;case 11:_fmt=fmt[1],_acc=__(2,[acc,fmt[0]]);continue;case 12:_fmt=fmt[1],_acc=__(3,[acc,fmt[0]]);continue;case 13:return function(k,acc,rest$3,ty){return function(){return make_printf(k,o,__(4,[acc,ty]),rest$3)}}(k,acc,fmt[2],string_of_fmtty(fmt[1]));case 14:var rest$4=fmt[2];return function(k,acc,fmtty,rest$4){return function(param){return make_printf(k,o,acc,concat_fmt(recast(param[0],fmtty),rest$4))}}(k,acc,fmt[1],rest$4);case 15:return function(k,acc,rest$5){return function(f,x){return make_printf(k,o,__(6,[acc,function(o){return _2(f,o,x)}]),rest$5)}}(k,acc,fmt[0]);case 16:return function(k,acc,rest$6){return function(f){return make_printf(k,o,__(6,[acc,f]),rest$6)}}(k,acc,fmt[0]);case 17:_fmt=fmt[1],_acc=__(0,[acc,fmt[0]]);continue;case 18:var match=fmt[0];if(match.tag){var k$prime=function(k,acc,rest$7){return function(koc,kacc){return make_printf(k,koc,__(1,[acc,__(1,[kacc])]),rest$7)}}(k,acc,fmt[1]);_fmt=match[0][0],_acc=0,_k=k$prime;continue}var k$prime$1=function(k,acc,rest$8){return function(koc,kacc){return make_printf(k,koc,__(1,[acc,__(0,[kacc])]),rest$8)}}(k,acc,fmt[1]);_fmt=match[0][0],_acc=0,_k=k$prime$1;continue;case 19:throw[assert_failure,["camlinternalFormat.ml",1449,4]];case 20:return function(k,rest$9,new_acc){return function(){return make_printf(k,o,new_acc,rest$9)}}(k,fmt[2],__(8,[acc,"Printf: bad conversion %["]));case 21:return function(k,acc,rest$10){return function(n){var new_acc_001=caml_format_int("%u",n),new_acc=__(4,[acc,new_acc_001]);return make_printf(k,o,new_acc,rest$10)}}(k,acc,fmt[1]);case 22:return function(k,acc,rest$11){return function(c){var new_acc=__(5,[acc,c]);return make_printf(k,o,new_acc,rest$11)}}(k,acc,fmt[0]);case 23:var k$2=k,o$2=o,acc$2=acc,ign=fmt[0],fmt$2=fmt[1];if("number"==typeof ign){if(3===ign)throw[assert_failure,["camlinternalFormat.ml",1517,39]];return make_invalid_arg(k$2,o$2,acc$2,fmt$2)}return 8===ign.tag?make_from_fmtty(k$2,o$2,acc$2,ign[1],fmt$2):make_invalid_arg(k$2,o$2,acc$2,fmt$2);case 24:return make_custom(k,o,acc,fmt[2],fmt[0],_1(fmt[1],0))}}}function make_from_fmtty(k,o,acc,fmtty,fmt){if("number"==typeof fmtty)return make_invalid_arg(k,o,acc,fmt);switch(0|fmtty.tag){case 0:var rest=fmtty[0];return function(){return make_from_fmtty(k,o,acc,rest,fmt)};case 1:var rest$1=fmtty[0];return function(){return make_from_fmtty(k,o,acc,rest$1,fmt)};case 2:var rest$2=fmtty[0];return function(){return make_from_fmtty(k,o,acc,rest$2,fmt)};case 3:var rest$3=fmtty[0];return function(){return make_from_fmtty(k,o,acc,rest$3,fmt)};case 4:var rest$4=fmtty[0];return function(){return make_from_fmtty(k,o,acc,rest$4,fmt)};case 5:var rest$5=fmtty[0];return function(){return make_from_fmtty(k,o,acc,rest$5,fmt)};case 6:var rest$6=fmtty[0];return function(){return make_from_fmtty(k,o,acc,rest$6,fmt)};case 7:var rest$7=fmtty[0];return function(){return make_from_fmtty(k,o,acc,rest$7,fmt)};case 8:var rest$8=fmtty[1];return function(){return make_from_fmtty(k,o,acc,rest$8,fmt)};case 9:var rest$9=fmtty[2],ty=trans(symm(fmtty[0]),fmtty[1]);return function(){return make_from_fmtty(k,o,acc,concat_fmtty(ty,rest$9),fmt)};case 10:var rest$10=fmtty[0];return function(_,_$1){return make_from_fmtty(k,o,acc,rest$10,fmt)};case 11:var rest$11=fmtty[0];return function(){return make_from_fmtty(k,o,acc,rest$11,fmt)};case 12:var rest$12=fmtty[0];return function(){return make_from_fmtty(k,o,acc,rest$12,fmt)};case 13:throw[assert_failure,["camlinternalFormat.ml",1540,31]];case 14:throw[assert_failure,["camlinternalFormat.ml",1541,31]]}}function make_invalid_arg(k,o,acc,fmt){return make_printf(k,o,__(8,[acc,"Printf: bad conversion %_"]),fmt)}function make_string_padding(k,o,acc,fmt,pad,trans){if("number"==typeof pad)return function(x){var new_acc_001=_1(trans,x),new_acc=__(4,[acc,new_acc_001]);return make_printf(k,o,new_acc,fmt)};if(pad.tag){var padty=pad[0];return function(w,x){var new_acc_001=fix_padding(padty,w,_1(trans,x)),new_acc=__(4,[acc,new_acc_001]);return make_printf(k,o,new_acc,fmt)}}var width=pad[1],padty$1=pad[0];return function(x){var new_acc_001=fix_padding(padty$1,width,_1(trans,x)),new_acc=__(4,[acc,new_acc_001]);return make_printf(k,o,new_acc,fmt)}}function make_int_padding_precision(k,o,acc,fmt,pad,prec,trans,iconv){if("number"==typeof pad){if("number"==typeof prec)return 0!==prec?function(p,x){var str=fix_int_precision(p,_2(trans,iconv,x));return make_printf(k,o,__(4,[acc,str]),fmt)}:function(x){var str=_2(trans,iconv,x);return make_printf(k,o,__(4,[acc,str]),fmt)};var p=prec[0];return function(x){var str=fix_int_precision(p,_2(trans,iconv,x));return make_printf(k,o,__(4,[acc,str]),fmt)}}if(pad.tag){var padty=pad[0];if("number"==typeof prec)return 0!==prec?function(w,p,x){var str=fix_padding(padty,w,fix_int_precision(p,_2(trans,iconv,x)));return make_printf(k,o,__(4,[acc,str]),fmt)}:function(w,x){var str=fix_padding(padty,w,_2(trans,iconv,x));return make_printf(k,o,__(4,[acc,str]),fmt)};var p$1=prec[0];return function(w,x){var str=fix_padding(padty,w,fix_int_precision(p$1,_2(trans,iconv,x)));return make_printf(k,o,__(4,[acc,str]),fmt)}}var w=pad[1],padty$1=pad[0];if("number"==typeof prec)return 0!==prec?function(p,x){var str=fix_padding(padty$1,w,fix_int_precision(p,_2(trans,iconv,x)));return make_printf(k,o,__(4,[acc,str]),fmt)}:function(x){var str=fix_padding(padty$1,w,_2(trans,iconv,x));return make_printf(k,o,__(4,[acc,str]),fmt)};var p$2=prec[0];return function(x){var str=fix_padding(padty$1,w,fix_int_precision(p$2,_2(trans,iconv,x)));return make_printf(k,o,__(4,[acc,str]),fmt)}}function make_custom(k,o,acc,rest,arity,f){if(arity){var arity$1=arity[0];return function(x){return make_custom(k,o,acc,rest,arity$1,_1(f,x))}}return make_printf(k,o,__(4,[acc,f]),rest)}function strput_acc(b,_acc){for(;;){var acc=_acc,exit$$1=0;if("number"==typeof acc)return 0;switch(0|acc.tag){case 0:var s=string_of_formatting_lit(acc[1]);return strput_acc(b,acc[0]),add_string(b,s);case 1:var match=acc[1];if(strput_acc(b,acc[0]),match.tag){add_string(b,"@["),_acc=match[0];continue}add_string(b,"@{"),_acc=match[0];continue;case 2:case 4:exit$$1=1;break;case 3:case 5:exit$$1=2;break;case 6:return strput_acc(b,acc[0]),add_string(b,_1(acc[1],0));case 7:_acc=acc[0];continue;case 8:throw strput_acc(b,acc[0]),[invalid_argument,acc[1]]}switch(exit$$1){case 1:return strput_acc(b,acc[0]),add_string(b,acc[1]);case 2:return strput_acc(b,acc[0]),add_char(b,acc[1])}}}function ksprintf(k,param){return make_printf(function(_,acc){var buf=function(n){var n$1=n<1?1:n,s=caml_create_string(n$1);return[s,0,n$1,s]}(64);return strput_acc(buf,acc),_1(k,sub_string((b=buf)[0],0,b[1]));var b},0,0,param[0])}function sprintf(fmt){return ksprintf(function(s){return s},fmt)}function opposite_color$1(param){return 0!==param?0:1}var piece_chars$1=[[0,75],[[1,81],[[2,82],[[3,66],[[4,78],[[5,80],0]]]]]];function char_of_piece_type$1(pt){return assoc(pt,piece_chars$1)}var init_array=function(sx,sy,init){for(var res=caml_make_vect(sx,[]),x=0,x_finish=sx-1|0;x<=x_finish;++x)res[x]=caml_make_vect(sy,init);return res}(8,8,0);function put(i,j,pt){return caml_array_set(caml_array_get(init_array,i),j,[[pt,1]]),caml_array_set(caml_array_get(init_array,i),7-j|0,[[pt,0]])}for(var i=0;i<=7;++i)put(i,1,5);put(0,0,2),put(7,0,2),put(1,0,4),put(6,0,4),put(2,0,3),put(5,0,3),put(3,0,1),put(4,0,0);var init_position$1=[init_array,1,[1,1],[1,1],0,0,0,[4,0],[4,7],0,0];function within_range$1(i){return i>=0?+(i<=7):0}function within_range2$1(param){return within_range$1(param[0])?within_range$1(param[1]):0}function copy_matrix$1(m){var tmp=copy(m);return function(f,a){for(var i=0,i_finish=a.length-1|0;i<=i_finish;++i)_2(f,i,a[i])}(function(i,elt){return caml_array_set(tmp,i,copy(elt))},m),tmp}function no_k_castle$1(param){return[param[0],0]}function no_q_castle$1(param){return[0,param[1]]}var Illegal_move$1=create("Ochess.Illegal_move");function make_move$1(pos,m,del){var ret,ar2=copy_matrix$1(pos[0]),mv=function(x1,y1,x2,y2){return caml_array_set(caml_array_get(ar2,x2),y2,caml_array_get(caml_array_get(ar2,x1),y1)),caml_array_set(caml_array_get(ar2,x1),y1,0)},tmp_001=opposite_color$1(pos[1]),tmp_002=pos[2],tmp_003=pos[3],tmp_005=[pos],tmp_006=pos[6],tmp_007=pos[7],tmp_008=pos[8],tmp_009=pos[9]+1|0,tmp_010=(0|-pos[10])+del|0,tmp=[ar2,tmp_001,tmp_002,tmp_003,0,tmp_005,tmp_006,tmp_007,tmp_008,tmp_009,tmp_010],t=pos[1],ic=0;if("number"==typeof m)if(m)if(0!==t){mv(0,0,3,0),mv(4,0,2,0);var newrecord=tmp.slice();newrecord[2]=[0,0],newrecord[7]=[2,0],ret=newrecord}else{mv(0,7,3,7),mv(4,7,2,7);var newrecord$1=tmp.slice();newrecord$1[3]=[0,0],newrecord$1[8]=[2,7],ret=newrecord$1}else if(0!==t){mv(7,0,5,0),mv(4,0,6,0);var newrecord$2=tmp.slice();newrecord$2[2]=[0,0],newrecord$2[7]=[6,0],ret=newrecord$2}else{mv(7,7,5,7),mv(4,7,6,7);var newrecord$3=tmp.slice();newrecord$3[3]=[0,0],newrecord$3[8]=[6,7],ret=newrecord$3}else if(m.tag){var x2=m[2];ic=1;var match=0!==t?[6,7]:[1,0],y2=match[1];mv(m[1],match[0],x2,y2),caml_array_set(caml_array_get(ar2,x2),y2,[[m[0],pos[1]]]),ret=tmp}else{var y2$1=m[3],x2$1=m[2],y1=m[1],x1=m[0];caml_array_get(caml_array_get(pos[0],x2$1),y2$1)||(ic=0),mv(x1,y1,x2$1,y2$1);var match$2=caml_array_get(caml_array_get(ar2,x2$1),y2$1);if(!match$2)throw Illegal_move$1;switch(match$2[0][0]){case 0:if(0!==pos[1]){var newrecord$4=tmp.slice();newrecord$4[2]=[0,0],newrecord$4[7]=[x2$1,y2$1],ret=newrecord$4}else{var newrecord$5=tmp.slice();newrecord$5[3]=[0,0],newrecord$5[8]=[x2$1,y2$1],ret=newrecord$5}break;case 2:if(0!==pos[1])if(0!==x1)if(7!==x1)ret=tmp;else if(0!==y1)ret=tmp;else{var newrecord$6=tmp.slice();newrecord$6[2]=no_k_castle$1(pos[3]),ret=newrecord$6}else if(0!==y1)ret=tmp;else{var newrecord$7=tmp.slice();newrecord$7[2]=no_q_castle$1(pos[2]),ret=newrecord$7}else if(0!==x1)if(7!==x1)ret=tmp;else if(7!==y1)ret=tmp;else{var newrecord$8=tmp.slice();newrecord$8[3]=no_k_castle$1(pos[3]),ret=newrecord$8}else if(7!==y1)ret=tmp;else{var newrecord$9=tmp.slice();newrecord$9[3]=no_q_castle$1(pos[2]),ret=newrecord$9}break;case 1:case 3:case 4:ret=tmp;break;case 5:ic=1;var e2,match$5=caml_array_get(caml_array_get(ar2,x2$1),y2$1),match$6=pos[1];if(match$5){var match$7=match$5[0];e2=match$7[0]>=5?0!==match$7[1]?0!==match$6&&x1===x2$1&&1===y1&&3===y2$1?[x1]:0:0!==match$6||x1!==x2$1||6!==y1||4!==y2$1?0:[x1]:0}else e2=0;var match$8=pos[4];if(match$8){var i=match$8[0];if(i===x2$1){0!==pos[1]?5===y2$1&&caml_array_set(caml_array_get(ar2,i),4,0):2===y2$1&&caml_array_set(caml_array_get(ar2,i),3,0)}}var newrecord$10=tmp.slice();newrecord$10[4]=e2,ret=newrecord$10}}var newrecord$11=ret.slice();return newrecord$11[6]=ic?0:pos[6]+1|0,newrecord$11}var knight$1=[[1,2],[[1,-2],[[2,1],[[2,-1],[[-1,2],[[-1,-2],[[-2,1],[[-2,-1],0]]]]]]]],rook$1=[[-1,0],[[0,-1],[[0,1],[[1,0],0]]]],bishop$1=[[-1,-1],[[-1,1],[[1,-1],[[1,1],0]]]],queen$1=$at(bishop$1,rook$1),pawn_white_cap$1=[[-1,1],[[1,1],0]],pawn_black_cap$1=[[-1,-1],[[1,-1],0]];function add$2(param,param$1){return[param[0]+param$1[0]|0,param[1]+param$1[1]|0]}function explore_directions$1(pos,x,y,lst,num){return flatten(map(function(direction){return function(pos,x_init,y_init,_x,_y,dx,dy,_num,_acc){for(;;){var acc=_acc,num=_num,y=_y,x=_x;if(num<1)return acc;var match=add$2([x,y],[dx,dy]),y2=match[1],x2=match[0];if(!within_range2$1([x2,y2]))return acc;var match$1=caml_array_get(caml_array_get(pos[0],x2),y2);if(match$1)return match$1[0][1]!==pos[1]?[__(0,[x_init,y_init,x2,y2]),acc]:acc;_acc=[__(0,[x_init,y_init,x2,y2]),acc],_num=num-1|0,_y=y2,_x=x2}}(pos,x,y,x,y,direction[0],direction[1],num,0)},lst))}function checked_direction$1(pos,t,pt_list,_x,_y,dx,dy,_num){for(;;){var num=_num,y=_y,x=_x;if(num<1)return 0;var match=add$2([x,y],[dx,dy]),y2=match[1],x2=match[0];if(!within_range2$1([x2,y2]))return 0;var match$1=caml_array_get(caml_array_get(pos[0],x2),y2);if(match$1){var match$2=match$1[0];return match$2[1]!==t?mem(match$2[0],pt_list):0}_num=num-1|0,_y=y2,_x=x2}}function checked_directions$1(pos,c,pt_list,x,y,_lst,num){for(;;){var lst=_lst;if(!lst)return 0;var match=lst[0];if(checked_direction$1(pos,c,pt_list,x,y,match[0],match[1],num))return 1;_lst=lst[1]}}function checked$1(pos,t,x,y){if(checked_directions$1(pos,t,[2,[1,0]],x,y,rook$1,10))return 1;if(checked_directions$1(pos,t,[3,[1,0]],x,y,bishop$1,10))return 1;if(checked_directions$1(pos,t,[4,0],x,y,knight$1,1))return 1;if(checked_directions$1(pos,t,[0,0],x,y,queen$1,1))return 1;return checked_directions$1(pos,t,[5,0],x,y,1===t?pawn_white_cap$1:pawn_black_cap$1,1)}function king_checked$1(pos,c){var match=function(pos,c){return[0!==c?pos[7]:pos[8]]}(pos,c);if(match){var match$1=match[0];return checked$1(pos,c,match$1[0],match$1[1])}return 0}function check_castle$1(pos,still_can,row,next,last,rk){if(still_can){if(caml_equal(caml_array_get(caml_array_get(pos[0],rk),row),[[2,pos[1]]])){if(function(pos,row,_x,y){for(;;){var x=_x;if(x>y)return 1;if(0!==caml_array_get(caml_array_get(pos[0],x),row))return 0;_x=x+1|0}}(pos,row,min(next,last),max(next,last))){if(checked$1(pos,pos[1],4,row))return 0;var a=copy_matrix$1(pos[0]);caml_array_set(caml_array_get(a,4),row,0),caml_array_set(caml_array_get(a,next),row,[[0,pos[1]]]);var newrecord=pos.slice();return 1-checked$1((newrecord[0]=a,newrecord),pos[1],next,row)}return 0}return 0}return 0}function possible_field_simple_moves$1(pos,x,y){var exp1=function(lst){return explore_directions$1(pos,x,y,lst,1)},expn=function(lst){return explore_directions$1(pos,x,y,lst,10)},match=caml_array_get(caml_array_get(pos[0],x),y);if(!match)return 0;var match$1=match[0],t=match$1[1];if(t!==pos[1])return 0;switch(match$1[0]){case 0:return $at(function(pos){var match$1=0!==pos[1]?[pos[2],0]:[pos[3],7],row=match$1[1],match$2=match$1[0];return $at(check_castle$1(pos,match$2[0],row,3,1,0)?[1,0]:0,check_castle$1(pos,match$2[1],row,5,6,7)?[0,0]:0)}(pos),exp1(queen$1));case 1:return expn(queen$1);case 2:return expn(rook$1);case 3:return expn(bishop$1);case 4:return exp1(knight$1);case 5:var y2=0!==t?y+1|0:y-1|0,tmp=[0],also=function(some_move){return tmp[0]=[some_move,tmp[0]],0},officers=[3,[4,[2,[1,0]]]];if(7===y2&&1===t||0===y2&&0===t){caml_array_get(caml_array_get(pos[0],x),y2)||iter(function(pt){return also(__(1,[pt,x,x]))},officers),iter(function(x2){if(within_range$1(x2)){var match=caml_array_get(caml_array_get(pos[0],x2),y2);return match&&match[0][1]!==t?iter(function(pt){return also(__(1,[pt,x,x2]))},officers):0}return 0},[x-1|0,[x+1|0,0]])}else{caml_array_get(caml_array_get(pos[0],x),y2)||also(__(0,[x,y,x,y2])),iter(function(x2){if(within_range$1(x2)){var match=caml_array_get(caml_array_get(pos[0],x2),y2);return match&&match[0][1]!==t?also(__(0,[x,y,x2,y2])):0}return 0},[x-1|0,[x+1|0,0]])}if(1!==y){if(6===y&&!t){var match$4=caml_array_get(caml_array_get(pos[0],x),5),match$5=caml_array_get(caml_array_get(pos[0],x),4);match$4||match$5||also(__(0,[x,y,x,4]))}}else if(0!==t){var match$6=caml_array_get(caml_array_get(pos[0],x),2),match$7=caml_array_get(caml_array_get(pos[0],x),3);match$6||match$7||also(__(0,[x,y,x,3]))}var match$8=pos[4];if(match$8){var i=match$8[0],y_en_passant=0!==t?5:2;iter(function(x2){return within_range$1(x2)&&x2===i&&y2===y_en_passant?also(__(0,[x,y,x2,y2])):0},[x-1|0,[x+1|0,0]])}return tmp[0]}}var board_center$1=[[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0],[0,0,3,5,5,3,0,0],[0,0,5,9,9,5,0,0],[0,0,5,9,9,5,0,0],[0,0,3,5,5,3,0,0],[0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0]];(function(pt,x,y,c){var tmp,y$1=function(c,y){return 0!==c?y:7-y|0}(c,y);switch(pt){case 0:tmp=1e6-imul(5,caml_array_get(caml_array_get(board_center$1,x),y$1))|0;break;case 1:tmp=9e3+imul(10,caml_array_get(caml_array_get(board_center$1,x),y$1))|0;break;case 2:tmp=5e3+imul(10,caml_array_get(caml_array_get(board_center$1,x),y$1))|0;break;case 3:tmp=3200+imul(20,caml_array_get(caml_array_get(board_center$1,x),y$1))|0;break;case 4:tmp=3e3+imul(30,caml_array_get(caml_array_get(board_center$1,x),y$1))|0;break;case 5:tmp=1e3+imul(30,caml_array_get(caml_array_get(board_center$1,x),y$1))|0}imul(5,y$1)})(0,0,0,1),create("Ochess.Interrupt"),create("Ochess.Illegal_position");function legal_moves$1(pos){return filter(function(m){return 1-king_checked$1(make_move$1(pos,m,0),pos[1])})(function(pos){for(var tmp=0,x=0;x<=7;++x)for(var y=0;y<=7;++y)tmp=$at(possible_field_simple_moves$1(pos,x,y),tmp);return tmp}(pos))}function string_of_piece_type(param){switch(param){case 0:return"king";case 1:return"queen";case 2:return"rook";case 3:return"bishop";case 4:return"knight";case 5:return"pawn"}}function string_of_color(param){return 0!==param?"white":"black"}function make_move(position,move){return make_move$1(position,move,0)}function long_move(position,move){if("number"==typeof move)return move?0:1;if(move.tag){var t_file=move[2],s_file=move[1];return __(1,[s_file,[t_file,0!==position[1]?7:0],+(s_file!==t_file),[move[0]]])}var t_rank$1=move[3],t_file$1=move[2],s_rank=move[1],s_file$1=move[0],match$1=caml_array_get(caml_array_get(position[0],s_file$1),s_rank);if(match$1){var p_type=match$1[0][0];if(p_type>=5)return __(1,[s_file$1,[t_file$1,t_rank$1],+(s_file$1!==t_file$1),0]);return __(0,[p_type,[s_file$1,s_rank],[t_file$1,t_rank$1],caml_array_get(caml_array_get(position[0],t_file$1),t_rank$1)?1:0])}throw Illegal_move$1}function unify(value,hint){return hint&&!caml_equal(value,hint[0])?0:1}function unique(move_list,short_move){return+(1===length(filter(function(param){return function(short_move,long_move){if("number"==typeof long_move)return 0;if(long_move.tag)return 0;var long_source=long_move[1];return caml_equal(short_move[3],long_move[2])&&short_move[0]===long_move[0]&&unify(long_source[0],short_move[1])?unify(long_source[1],short_move[2]):0}(short_move,param)})(move_list)))}function san_of_move$prime(position,move_list,move){var san,long_move$1=long_move(position,move),check=function(position,move){var position$prime=make_move(position,move);if(king_checked$1(position$prime,position$prime[1]))return legal_moves$1(position$prime)?0:1;return 2}(position,move),short_move_option=function(move_list,long_move){if("number"==typeof long_move)return 0;if(long_move.tag)return 0;var capture=long_move[3],target=long_move[2],match=long_move[1],s_rank=match[1],s_file=match[0],p_type=long_move[0],qg7=[p_type,0,0,target,capture];if(unique(move_list,qg7))return[qg7];var qhg7=[p_type,[s_file],0,target,capture];if(unique(move_list,qhg7))return[qhg7];var q8g7=[p_type,0,[s_rank],target,capture];return unique(move_list,q8g7)?[q8g7]:[[p_type,[s_file],[s_rank],target,capture]]}(move_list,long_move$1);if(short_move_option){var match=short_move_option[0],match$1=match[3],rank_hint=match[2],file_hint=match[1];san=_6(sprintf([__(0,[__(2,[0,__(2,[0,__(2,[0,__(0,[__(0,[0])])])])])]),"%c%s%s%s%c%c"]),char_of_piece_type$1(match[0]),file_hint?_1(sprintf([__(0,[0]),"%c"]),get("abcdefgh",file_hint[0])):"",rank_hint?_1(sprintf([__(0,[0]),"%c"]),get("12345678",rank_hint[0])):"",match[4]?"x":"",get("abcdefgh",match$1[0]),get("12345678",match$1[1]))}else if("number"==typeof long_move$1)san=long_move$1?"O-O":"O-O-O";else{if(!long_move$1.tag)throw Illegal_move$1;var promotion=long_move$1[3],match$2=long_move$1[1];san=_4(sprintf([__(2,[0,__(0,[__(0,[__(2,[0,0])])])]),"%s%c%c%s"]),long_move$1[2]?_1(sprintf([__(0,[__(12,[120,0])]),"%cx"]),get("abcdefgh",long_move$1[0])):"",get("abcdefgh",match$2[0]),get("12345678",match$2[1]),promotion?_1(sprintf([__(12,[61,__(0,[0])]),"=%c"]),char_of_piece_type$1(promotion[0])):"")}var tmp;switch(check){case 0:tmp="+";break;case 1:tmp="#";break;case 2:tmp=""}return san+tmp}var opposite_color=opposite_color$1,init_position=init_position$1,game_status=function(pos){if(function(pos){return pos[6]>=100?1:function(pos,_p,_n){for(;;){var n=_n,p=_p;if(n<=0)return 1;if(n<<1>p[6])return 0;var match=p[5];if(!match)return 0;var pp=match[0];y=pp,(x=pos)[10]===y[10]&&x[1]===y[1]&&caml_equal(x[2],y[2])&&caml_equal(x[3],y[3])&&caml_equal(x[4],y[4])&&caml_equal(x[0],y[0])?(_n=n-1|0,_p=pp):_p=pp}var x,y}(pos,pos,2)}(pos))return 0;var lm=legal_moves$1(pos);return lm?__(1,[lm]):king_checked$1(pos,pos[1])?__(0,[opposite_color$1(pos[1])]):0};function setStyleProperty(n,$staropt$star,key,value){var priority=$staropt$star?$staropt$star[0]:0,style=n.style;return void 0!==style.setProperty?style.setProperty(key,value,priority?"important":null):function(n,key,value){return n.style[key]=value,0}(n,key,value)}function insertBefore(n,child,refNode){return n.insertBefore(child,refNode)}function setAttributeNsOptional(n,namespace,key,value){return""===namespace?n.setAttribute(key,value):n.setAttributeNS(namespace,key,value)}function createElementNsOptional(namespace,tagName){return""===namespace?document.createElement(tagName):document.createElementNS(namespace,tagName)}function fullnode(namespace,tagName,key,unique,props,vdoms){return __(2,[namespace,tagName,key,unique,props,vdoms])}function renderToHtmlString(_param){for(;;){var param=_param;switch(0|param.tag){case 0:return"\x3c!-- "+param[0]+" --\x3e";case 1:return param[0];case 2:var tagName=param[1],namespace=param[0];return concat$3("",["<",[namespace,[""===namespace?"":":",[tagName,[concat$3("",map(function(p){var param=p;if("number"==typeof param)return"";switch(0|param.tag){case 0:return concat$3("",[" ",[param[0],['="',[param[1],['"',0]]]]]);case 1:return concat$3("",[" ",[param[1],['="',[param[2],['"',0]]]]]);case 2:return concat$3("",[" data-",[param[0],['="',[param[1],['"',0]]]]]);case 3:return"";case 4:return concat$3("",[' style="',[concat$3(";",map(function(param){return concat$3("",[param[0],[":",[param[1],[";",0]]]])},param[0])),['"',0]]])}},param[4])),[">",[concat$3("",map(renderToHtmlString,param[5])),["</",[tagName,[">",0]]]]]]]]]]);case 3:_param=_1(param[1],0);continue;case 4:_param=param[1];continue}}}function eventHandler_GetCB(param){if(param.tag){var msg=param[0];return function(){return[msg]}}return param[1]}function eventHandler_Register(callbacks,elem,name,handlerType){var cb=[eventHandler_GetCB(handlerType)],handler=function(callbacks,cb){return function(ev){var match=_1(cb[0],ev);return match?_1(callbacks[0][0],match[0]):0}}(callbacks,cb);typ=name,listener=handler,options=0,elem.addEventListener(typ,listener,options);var typ,listener,options;return[[handler,cb]]}function eventHandler_Unregister(elem,name,param){return param?(n=elem,typ=name,listener=param[0][0],options=0,n.removeEventListener(typ,listener,options),0):0;var n,typ,listener,options}function eventHandler_Mutate(callbacks,elem,oldName,newName,oldHandlerType,newHandlerType,oldCache,newCache){var match=oldCache[0];if(match){if(oldName===newName){if(newCache[0]=oldCache[0],left=oldHandlerType,(param=newHandlerType).tag?!left.tag||!caml_equal(param[0],left[0]):left.tag||param[0]!==left[0]){var cb=eventHandler_GetCB(newHandlerType);return match[0][1][0]=cb,0}return 0}return oldCache[0]=eventHandler_Unregister(elem,oldName,oldCache[0]),newCache[0]=eventHandler_Register(callbacks,elem,newName,newHandlerType),0}return newCache[0]=eventHandler_Register(callbacks,elem,newName,newHandlerType),0;var left,param}function patchVNodesOnElems_PropertiesApply_RemoveAdd(callbacks,elem,idx,oldProp,newProp){return function(_,elem,_$1,param){if("number"==typeof param)return 0;switch(0|param.tag){case 0:return elem[param[0]]=void 0,0;case 1:return n=elem,namespace=param[0],key=param[1],""===namespace?n.removeAttribute(key):n.removeAttributeNS(namespace,key);case 2:throw console.log(["TODO:  Remove Data Unhandled",param[0],param[1]]),[failure,"TODO:  Remove Data Unhandled"];case 3:var cache=param[2];return cache[0]=eventHandler_Unregister(elem,param[0],cache[0]),0;case 4:return fold_left(function(_,param){return setStyleProperty(elem,0,param[0],null)},0,param[0])}var n,namespace,key}(0,elem,0,oldProp),function(callbacks,elem,_,param){if("number"==typeof param)return 0;switch(0|param.tag){case 0:return elem[param[0]]=param[1],0;case 1:return setAttributeNsOptional(elem,param[0],param[1],param[2]);case 2:throw console.log(["TODO:  Add Data Unhandled",param[0],param[1]]),[failure,"TODO:  Add Data Unhandled"];case 3:return param[2][0]=eventHandler_Register(callbacks,elem,param[0],param[1]),0;case 4:fold_left(function(_,param){return setStyleProperty(elem,0,param[0],param[1])},0,param[0])}}(callbacks,elem,0,newProp),0}function patchVNodesOnElems_PropertiesApply_Mutate(_,elem,_$1,oldProp,_newProp){if("number"==typeof _newProp)throw[failure,"This should never be called as all entries through NoProp are gated."];switch(0|_newProp.tag){case 0:return elem[_newProp[0]]=_newProp[1],0;case 1:return setAttributeNsOptional(elem,_newProp[0],_newProp[1],_newProp[2]);case 2:throw console.log(["TODO:  Mutate Data Unhandled",_newProp[0],_newProp[1]]),[failure,"TODO:  Mutate Data Unhandled"];case 3:throw[failure,"This will never be called because it is gated"];case 4:if("number"==typeof oldProp)throw[failure,"Passed a non-Style to a new Style as a Mutations while the old Style is not actually a style!"];if(4===oldProp.tag)return function(f,_accu,_l1,_l2){for(;;){var l2=_l2,l1=_l1,accu=_accu;if(l1){if(l2){_l2=l2[1],_l1=l1[1],_accu=_3(f,accu,l1[0],l2[0]);continue}throw[invalid_argument,"List.fold_left2"]}if(l2)throw[invalid_argument,"List.fold_left2"];return accu}}(function(_,param,param$1){var nv=param$1[1],nk=param$1[0],ok=param[0];return ok===nk?param[1]===nv?0:setStyleProperty(elem,0,nk,nv):(setStyleProperty(elem,0,ok,null),setStyleProperty(elem,0,nk,nv))},0,oldProp[0],_newProp[0]);throw[failure,"Passed a non-Style to a new Style as a Mutations while the old Style is not actually a style!"]}}function patchVNodesOnElems_Properties(callbacks,elem,oldProperties,newProperties){return function(callbacks,elem,_idx,_oldProperties,_newProperties){for(;;){var newProperties=_newProperties,oldProperties=_oldProperties,idx=_idx;if(!oldProperties)return newProperties?0:1;var _oldProp=oldProperties[0],exit=0;if(!newProperties)return 0;if("number"==typeof _oldProp){if("number"==typeof newProperties[0]){_newProperties=newProperties[1],_oldProperties=oldProperties[1],_idx=idx+1|0;continue}exit=1}else switch(0|_oldProp.tag){case 0:var newProp=newProperties[0];if("number"==typeof newProp)exit=1;else{if(!newProp.tag){_oldProp[0]===newProp[0]&&_oldProp[1]===newProp[1]||patchVNodesOnElems_PropertiesApply_Mutate(0,elem,0,_oldProp,newProp),_newProperties=newProperties[1],_oldProperties=oldProperties[1],_idx=idx+1|0;continue}exit=1}break;case 1:var newProp$1=newProperties[0];if("number"==typeof newProp$1)exit=1;else{if(1===newProp$1.tag){_oldProp[0]===newProp$1[0]&&_oldProp[1]===newProp$1[1]&&_oldProp[2]===newProp$1[2]||patchVNodesOnElems_PropertiesApply_Mutate(0,elem,0,_oldProp,newProp$1),_newProperties=newProperties[1],_oldProperties=oldProperties[1],_idx=idx+1|0;continue}exit=1}break;case 2:var newProp$2=newProperties[0];if("number"==typeof newProp$2)exit=1;else{if(2===newProp$2.tag){_oldProp[0]===newProp$2[0]&&_oldProp[1]===newProp$2[1]||patchVNodesOnElems_PropertiesApply_Mutate(0,elem,0,_oldProp,newProp$2),_newProperties=newProperties[1],_oldProperties=oldProperties[1],_idx=idx+1|0;continue}exit=1}break;case 3:var _newProp=newProperties[0];if("number"==typeof _newProp)exit=1;else{if(3===_newProp.tag){eventHandler_Mutate(callbacks,elem,_oldProp[0],_newProp[0],_oldProp[1],_newProp[1],_oldProp[2],_newProp[2]),_newProperties=newProperties[1],_oldProperties=oldProperties[1],_idx=idx+1|0;continue}exit=1}break;case 4:var newProp$3=newProperties[0];if("number"==typeof newProp$3)exit=1;else{if(4===newProp$3.tag){caml_equal(_oldProp[0],newProp$3[0])||patchVNodesOnElems_PropertiesApply_Mutate(0,elem,0,_oldProp,newProp$3),_newProperties=newProperties[1],_oldProperties=oldProperties[1],_idx=idx+1|0;continue}exit=1}}1!==exit||(patchVNodesOnElems_PropertiesApply_RemoveAdd(callbacks,elem,0,_oldProp,newProperties[0]),_newProperties=newProperties[1],_oldProperties=oldProperties[1],_idx=idx+1|0)}}(callbacks,elem,0,oldProperties,newProperties)}function patchVNodesOnElems_ReplaceNode(callbacks,elem,elems,idx,param){if(2===param.tag){var newProperties=param[4],oldChild=caml_array_get(elems,idx),newChild=createElementNsOptional(param[0],param[1]);if(0!==patchVNodesOnElems_Properties(callbacks,newChild,map(function(){return 0},newProperties),newProperties)){return patchVNodesOnElems(callbacks,newChild,newChild.childNodes,0,0,param[5]),insertBefore(elem,newChild,oldChild),elem.removeChild(oldChild),0}throw[match_failure,["/Users/daniel/Playground/tea-chess/node_modules/bucklescript-tea/src/vdom.ml",319,30]]}throw[failure,"Node replacement should never be passed anything but a node itself"]}function patchVNodesOnElems_CreateElement(_callbacks,_param){for(;;){var param=_param,callbacks=_callbacks;switch(0|param.tag){case 0:var text=param[0];return document.createComment(text);case 1:var text$1=param[0];return document.createTextNode(text$1);case 2:var newProperties=param[4],newChild=createElementNsOptional(param[0],param[1]);if(0!==patchVNodesOnElems_Properties(callbacks,newChild,map(function(){return 0},newProperties),newProperties)){return patchVNodesOnElems(callbacks,newChild,newChild.childNodes,0,0,param[5]),newChild}throw[match_failure,["/Users/daniel/Playground/tea-chess/node_modules/bucklescript-tea/src/vdom.ml",333,30]];case 3:var vdom=_1(param[1],0);param[2][0]=vdom,_param=vdom;continue;case 4:_param=param[1],_callbacks=_1(param[0],callbacks);continue}}}function patchVNodesOnElems_MutateNode(callbacks,elem,elems,idx,oldNode,newNode){if(2===oldNode.tag){if(2===newNode.tag){if(oldNode[3]!==newNode[3]||oldNode[1]!==newNode[1])return patchVNodesOnElems_ReplaceNode(callbacks,elem,elems,idx,newNode);var child=caml_array_get(elems,idx),childChildren=child.childNodes;return patchVNodesOnElems_Properties(callbacks,child,oldNode[4],newNode[4])||(console.log("VDom:  Failed swapping properties because the property list length changed, use `noProp` to swap properties instead, not by altering the list structure.  This is a massive inefficiency until this issue is resolved."),patchVNodesOnElems_ReplaceNode(callbacks,elem,elems,idx,newNode)),patchVNodesOnElems(callbacks,child,childChildren,0,oldNode[5],newNode[5])}throw[failure,"Non-node passed to patchVNodesOnElems_MutateNode"]}throw[failure,"Non-node passed to patchVNodesOnElems_MutateNode"]}function patchVNodesOnElems(callbacks,elem,elems,_idx,_oldVNodes,_newVNodes){for(;;){var newVNodes=_newVNodes,oldVNodes=_oldVNodes,idx=_idx;if(!oldVNodes){if(newVNodes){var newChild$3=patchVNodesOnElems_CreateElement(callbacks,newVNodes[0]);elem.appendChild(newChild$3),_newVNodes=newVNodes[1],_oldVNodes=0,_idx=idx+1|0;continue}return 0}var oldNode=oldVNodes[0],exit=0;switch(0|oldNode.tag){case 0:if(newVNodes){var match=newVNodes[0];if(match.tag)exit=1;else{if(oldNode[0]===match[0]){_newVNodes=newVNodes[1],_oldVNodes=oldVNodes[1],_idx=idx+1|0;continue}exit=1}}else exit=1;break;case 1:if(newVNodes){var match$1=newVNodes[0];if(1===match$1.tag){var newText=match$1[0];if(oldNode[0]!==newText){caml_array_get(elems,idx).nodeValue=newText}_newVNodes=newVNodes[1],_oldVNodes=oldVNodes[1],_idx=idx+1|0;continue}exit=1}else exit=1;break;case 2:if(newVNodes){var newNode=newVNodes[0];if(2===newNode.tag){var newRest=newVNodes[1],newKey=newNode[2],newTagName=newNode[1],newNamespace=newNode[0],oldRest=oldVNodes[1],oldKey=oldNode[2],oldTagName=oldNode[1],oldNamespace=oldNode[0];if(oldKey===newKey&&""!==oldKey){_newVNodes=newRest,_oldVNodes=oldRest,_idx=idx+1|0;continue}if(""===oldKey||""===newKey){patchVNodesOnElems_MutateNode(callbacks,elem,elems,idx,oldNode,newNode),_newVNodes=newRest,_oldVNodes=oldRest,_idx=idx+1|0;continue}var exit$1=0,exit$2=0;if(oldRest){var match$2=oldRest[0];if(2===match$2.tag){var olderRest=oldRest[1],olderKey=match$2[2],olderTagName=match$2[1],olderNamespace=match$2[0],exit$3=0;if(newRest){var match$3=newRest[0];if(2===match$3.tag){if(olderNamespace===newNamespace&&olderTagName===newTagName&&olderKey===newKey&&oldNamespace===match$3[0]&&oldTagName===match$3[1]&&oldKey===match$3[2]){var firstChild$$1=caml_array_get(elems,idx),secondChild=caml_array_get(elems,idx+1|0);elem.removeChild(secondChild),insertBefore(elem,secondChild,firstChild$$1),_newVNodes=newRest[1],_oldVNodes=olderRest,_idx=idx+2|0;continue}exit$3=4}else exit$3=4}else exit$3=4;if(4===exit$3){if(olderNamespace===newNamespace&&olderTagName===newTagName&&olderKey===newKey){var oldChild=caml_array_get(elems,idx);elem.removeChild(oldChild),_newVNodes=newRest,_oldVNodes=olderRest,_idx=idx+1|0;continue}exit$2=3}}else exit$2=3}else exit$2=3;if(3===exit$2)if(newRest){var match$4=newRest[0];if(2===match$4.tag){if(oldNamespace===match$4[0]&&oldTagName===match$4[1]&&oldKey===match$4[2]){var oldChild$1=caml_array_get(elems,idx);insertBefore(elem,patchVNodesOnElems_CreateElement(callbacks,newNode),oldChild$1),_newVNodes=newRest,_idx=idx+1|0;continue}exit$1=2}else exit$1=2}else exit$1=2;if(2===exit$1){patchVNodesOnElems_MutateNode(callbacks,elem,elems,idx,oldNode,newNode),_newVNodes=newRest,_oldVNodes=oldRest,_idx=idx+1|0;continue}}else exit=1}else exit=1;break;case 3:if(newVNodes){var match$5=newVNodes[0];if(3===match$5.tag){var newRest$1=newVNodes[1],newCache=match$5[2],newGen=match$5[1],newKey$1=match$5[0],oldRest$1=oldVNodes[1],oldCache=oldNode[2],oldKey$1=oldNode[0];if(oldKey$1===newKey$1){newCache[0]=oldCache[0],_newVNodes=newRest$1,_oldVNodes=oldRest$1,_idx=idx+1|0;continue}var exit$4=0,exit$5=0;if(oldRest$1){var match$6=oldRest$1[0];if(3===match$6.tag){var olderRest$1=oldRest$1[1],olderKey$1=match$6[0],exit$6=0;if(newRest$1){var match$7=newRest$1[0];if(3===match$7.tag){if(olderKey$1===newKey$1&&oldKey$1===match$7[0]){var firstChild$1=caml_array_get(elems,idx),secondChild$1=caml_array_get(elems,idx+1|0);elem.removeChild(secondChild$1),insertBefore(elem,secondChild$1,firstChild$1),_newVNodes=newRest$1[1],_oldVNodes=olderRest$1,_idx=idx+2|0;continue}exit$6=4}else exit$6=4}else exit$6=4;if(4===exit$6){if(olderKey$1===newKey$1){var oldChild$2=caml_array_get(elems,idx);elem.removeChild(oldChild$2);var oldVdom=match$6[2][0];newCache[0]=oldVdom,_newVNodes=newRest$1,_oldVNodes=olderRest$1,_idx=idx+1|0;continue}exit$5=3}}else exit$5=3}else exit$5=3;if(3===exit$5)if(newRest$1){var match$8=newRest$1[0];if(3===match$8.tag){if(match$8[0]===oldKey$1){var oldChild$3=caml_array_get(elems,idx),newVdom=_1(newGen,0);newCache[0]=newVdom;insertBefore(elem,patchVNodesOnElems_CreateElement(callbacks,newVdom),oldChild$3),_newVNodes=newRest$1,_idx=idx+1|0;continue}exit$4=2}else exit$4=2}else exit$4=2;if(2===exit$4){var oldVdom$1=oldCache[0],newVdom$1=_1(newGen,0);newCache[0]=newVdom$1,_newVNodes=[newVdom$1,newRest$1],_oldVNodes=[oldVdom$1,oldRest$1];continue}}else exit=1}else exit=1;break;case 4:_oldVNodes=[oldNode[1],oldVNodes[1]];continue}if(1!==exit);else{var oldRest$2=oldVNodes[1];if(newVNodes){var newNode$1=newVNodes[0];if(4===newNode$1.tag){patchVNodesOnElems(_1(newNode$1[0],callbacks),elem,elems,idx,[oldNode,0],[newNode$1[1],0]),_newVNodes=newVNodes[1],_oldVNodes=oldRest$2,_idx=idx+1|0;continue}var oldChild$4=caml_array_get(elems,idx);insertBefore(elem,patchVNodesOnElems_CreateElement(callbacks,newNode$1),oldChild$4),elem.removeChild(oldChild$4),_newVNodes=newVNodes[1],_oldVNodes=oldRest$2,_idx=idx+1|0;continue}var child$1=caml_array_get(elems,idx);elem.removeChild(child$1),_newVNodes=0,_oldVNodes=oldRest$2}}}function msg(msg$1){return __(2,[function(callbacks){return _1(callbacks[0][0],msg$1)}])}function run(callbacks,param){if("number"==typeof param)return 0;switch(0|param.tag){case 1:return fold_left(function(_,cmd){return run(callbacks,cmd)},0,param[0]);case 0:case 2:return _1(param[0],callbacks)}}function map$4(func,cmd){return __(0,[function(callbacks){return run(function(func,callbacks){return[[function(msg){return _1(callbacks[0][0],_1(func,msg))}]]}(func,callbacks),cmd)}])}var none=0;function batch$1(subs){return __(0,[subs])}function registration(key,enableCall){return __(1,[key,function(callbacks){return _1(enableCall,callbacks[0])},[0]])}function run$1(oldCallbacks,newCallbacks,oldSub,newSub){var enable=function(_callbacks,_param){for(;;){var param=_param,callbacks=_callbacks;if("number"==typeof param)return 0;switch(0|param.tag){case 0:var subs=param[0];return subs?iter(function(callbacks){return function(param){return enable(callbacks,param)}}(callbacks),subs):0;case 1:return param[2][0]=[_1(param[1],callbacks)],0;case 2:var subCallbacks=_1(param[0],callbacks);_param=param[1],_callbacks=subCallbacks;continue}}},disable=function(_callbacks,_param){for(;;){var param=_param,callbacks=_callbacks;if("number"==typeof param)return 0;switch(0|param.tag){case 0:var subs=param[0];return subs?iter(function(callbacks){return function(param){return disable(callbacks,param)}}(callbacks),subs):0;case 1:var diCB=param[2],match=diCB[0];return match?(diCB[0]=0,_1(match[0],0)):0;case 2:var subCallbacks=_1(param[0],callbacks);_param=param[1],_callbacks=subCallbacks;continue}}},exit=0;if("number"==typeof oldSub){if("number"==typeof newSub)return newSub;exit=1}else switch(0|oldSub.tag){case 0:if("number"==typeof newSub)exit=1;else{if(!newSub.tag){return function(_oldList,_newList){for(;;){var newList=_newList,oldList=_oldList;if(oldList){var oldRest=oldList[1],oldSubSub=oldList[0];if(newList){run$1(oldCallbacks,newCallbacks,oldSubSub,newList[0]),_newList=newList[1],_oldList=oldRest;continue}disable(oldCallbacks,oldSubSub),_newList=0,_oldList=oldRest}else{if(!newList)return 0;enable(newCallbacks,newList[0]),_newList=newList[1],_oldList=0}}}(oldSub[0],newSub[0]),newSub}exit=1}break;case 1:if("number"==typeof newSub)exit=1;else if(1===newSub.tag){if(oldSub[0]===newSub[0])return newSub[2][0]=oldSub[2][0],newSub;exit=1}else exit=1;break;case 2:if("number"==typeof newSub)exit=1;else{if(2===newSub.tag){return run$1(_1(oldSub[0],oldCallbacks),_1(newSub[0],newCallbacks),oldSub[1],newSub[1]),newSub}exit=1}}if(1===exit)return disable(oldCallbacks,oldSub),enable(newCallbacks,newSub),newSub}var none$1=0;function text$1(str){return __(1,[str])}function node$1($staropt$star,tagName,$staropt$star$1,$staropt$star$2,props,nodes){return fullnode($staropt$star?$staropt$star[0]:"",tagName,$staropt$star$1?$staropt$star$1[0]:"",$staropt$star$2?$staropt$star$2[0]:"",props,nodes)}function span($staropt$star,$staropt$star$1,props,nodes){return fullnode("","span",$staropt$star?$staropt$star[0]:"",$staropt$star$1?$staropt$star$1[0]:"",props,nodes)}function p($staropt$star,$staropt$star$1,props,nodes){return fullnode("","p",$staropt$star?$staropt$star[0]:"",$staropt$star$1?$staropt$star$1[0]:"",props,nodes)}function button($staropt$star,$staropt$star$1,props,nodes){return fullnode("","button",$staropt$star?$staropt$star[0]:"",$staropt$star$1?$staropt$star$1[0]:"",props,nodes)}function li($staropt$star,$staropt$star$1,props,nodes){return fullnode("","li",$staropt$star?$staropt$star[0]:"",$staropt$star$1?$staropt$star$1[0]:"",props,nodes)}function class$prime(name){return __(0,["className",name])}function classList(classes){return __(0,["className",concat$3(" ",map(function(param){return param[0]},filter(function(param){return param[1]})(classes)))])}function styles$1(s){return __(4,[s])}var onCB$1=function(name,key,cb){return __(3,[name,__(0,[key,cb]),[0]])};function onClick(msg){return function(name,msg){return __(3,[name,__(1,[msg]),[0]])}("click",msg)}var noNode$1=__(0,[""]),noProp$1=0;var classify=function(x){var ty=typeof x;return"string"===ty?__(0,[x]):"number"===ty?__(1,[x]):"boolean"===ty?!0===x?1:0:null===x?2:Array.isArray(x)?__(3,[x]):__(2,[x])};function first(fst,e){return e.tag?e:fst}function height(param){return param?param[4]:0}function create$2(l,x,d,r){var hl=height(l),hr=height(r);return[l,x,d,r,hl>=hr?hl+1|0:hr+1|0]}function singleton(x,d){return[0,x,d,0,1]}function bal(l,x,d,r){var hl=l?l[4]:0,hr=r?r[4]:0;if(hl>(hr+2|0)){if(l){var lr=l[3],ld=l[2],lv=l[1],ll=l[0];if(height(ll)>=height(lr))return create$2(ll,lv,ld,create$2(lr,x,d,r));if(lr)return create$2(create$2(ll,lv,ld,lr[0]),lr[1],lr[2],create$2(lr[3],x,d,r));throw[invalid_argument,"Map.bal"]}throw[invalid_argument,"Map.bal"]}if(hr>(hl+2|0)){if(r){var rr=r[3],rd=r[2],rv=r[1],rl=r[0];if(height(rr)>=height(rl))return create$2(create$2(l,x,d,rl),rv,rd,rr);if(rl)return create$2(create$2(l,x,d,rl[0]),rl[1],rl[2],create$2(rl[3],rv,rd,rr));throw[invalid_argument,"Map.bal"]}throw[invalid_argument,"Map.bal"]}return[l,x,d,r,hl>=hr?hl+1|0:hr+1|0]}function add$3(x,data,param){if(param){var r=param[3],d=param[2],v=param[1],l=param[0],c=caml_string_compare(x,v);return c?c<0?bal(add$3(x,data,l),v,d,r):bal(l,v,d,add$3(x,data,r)):[l,x,data,r,param[4]]}return[0,x,data,0,1]}function min_binding(_param){for(;;){var param=_param;if(param){var l=param[0];if(l){_param=l;continue}return[param[1],param[2]]}throw not_found}}function remove_min_binding(param){if(param){var l=param[0];return l?bal(remove_min_binding(l),param[1],param[2],param[3]):param[3]}throw[invalid_argument,"Map.remove_min_elt"]}function remove$1(x,param){if(param){var r=param[3],d=param[2],v=param[1],l=param[0],c=caml_string_compare(x,v);if(c)return c<0?bal(remove$1(x,l),v,d,r):bal(l,v,d,remove$1(x,r));var t1=l,t2=r;if(t1){if(t2){var match=min_binding(t2);return bal(t1,match[0],match[1],remove_min_binding(t2))}return t1}return t2}return 0}function iter$4(f,_param){for(;;){var param=_param;if(!param)return 0;iter$4(f,param[0]),_2(f,param[1],param[2]),_param=param[3]}}function map$7(f,param){if(param){var l$prime=map$7(f,param[0]),d$prime=_1(f,param[2]),r$prime=map$7(f,param[3]);return[l$prime,param[1],d$prime,r$prime,param[4]]}return 0}function mapi$4(f,param){if(param){var v=param[1];return[mapi$4(f,param[0]),v,_2(f,v,param[2]),mapi$4(f,param[3]),param[4]]}return 0}function fold(f,_m,_accu){for(;;){var accu=_accu,m=_m;if(!m)return accu;_accu=_3(f,m[1],m[2],fold(f,m[0],accu)),_m=m[3]}}function for_all$1(p,_param){for(;;){var param=_param;if(param){if(_2(p,param[1],param[2])){if(for_all$1(p,param[0])){_param=param[3];continue}return 0}return 0}return 1}}function exists$1(p,_param){for(;;){var param=_param;if(!param)return 0;if(_2(p,param[1],param[2]))return 1;if(exists$1(p,param[0]))return 1;_param=param[3]}}function add_min_binding(k,v,param){return param?bal(add_min_binding(k,v,param[0]),param[1],param[2],param[3]):singleton(k,v)}function add_max_binding(k,v,param){return param?bal(param[0],param[1],param[2],add_max_binding(k,v,param[3])):singleton(k,v)}function join(l,v,d,r){if(l){if(r){var rh=r[4],lh=l[4];return lh>(rh+2|0)?bal(l[0],l[1],l[2],join(l[3],v,d,r)):rh>(lh+2|0)?bal(join(l,v,d,r[0]),r[1],r[2],r[3]):create$2(l,v,d,r)}return add_max_binding(v,d,l)}return add_min_binding(v,d,r)}function concat$4(t1,t2){if(t1){if(t2){var match=min_binding(t2);return join(t1,match[0],match[1],remove_min_binding(t2))}return t1}return t2}function concat_or_join(t1,v,d,t2){return d?join(t1,v,d[0],t2):concat$4(t1,t2)}function split$1(x,param){if(param){var r=param[3],d=param[2],v=param[1],l=param[0],c=caml_string_compare(x,v);if(c){if(c<0){var match=split$1(x,l);return[match[0],match[1],join(match[2],v,d,r)]}var match$1=split$1(x,r);return[join(l,v,d,match$1[0]),match$1[1],match$1[2]]}return[l,[d],r]}return[0,0,0]}function merge$1(f,s1,s2){var exit$$1=0;if(s1){var v1=s1[1];if(s1[4]>=height(s2)){var match=split$1(v1,s2);return concat_or_join(merge$1(f,s1[0],match[0]),v1,_3(f,v1,[s1[2]],match[1]),merge$1(f,s1[3],match[2]))}exit$$1=1}else{if(!s2)return 0;exit$$1=1}if(1===exit$$1){if(s2){var v2=s2[1],match$1=split$1(v2,s1);return concat_or_join(merge$1(f,match$1[0],s2[0]),v2,_3(f,v2,match$1[1],[s2[2]]),merge$1(f,match$1[2],s2[3]))}throw[assert_failure,["map.ml",270,10]]}}function filter$1(p,param){if(param){var d=param[2],v=param[1],l$prime=filter$1(p,param[0]),pvd=_2(p,v,d),r$prime=filter$1(p,param[3]);return pvd?join(l$prime,v,d,r$prime):concat$4(l$prime,r$prime)}return 0}function partition$1(p,param){if(param){var d=param[2],v=param[1],match=partition$1(p,param[0]),lf=match[1],lt=match[0],pvd=_2(p,v,d),match$1=partition$1(p,param[3]),rf=match$1[1],rt=match$1[0];return pvd?[join(lt,v,d,rt),concat$4(lf,rf)]:[concat$4(lt,rt),join(lf,v,d,rf)]}return[0,0]}function cons_enum(_m,_e){for(;;){var e=_e,m=_m;if(!m)return e;_e=[m[1],m[2],m[3],e],_m=m[0]}}function cardinal(param){return param?(cardinal(param[0])+1|0)+cardinal(param[3])|0:0}function bindings_aux(_accu,_param){for(;;){var param=_param,accu=_accu;if(!param)return accu;_param=param[0],_accu=[[param[1],param[2]],bindings_aux(accu,param[3])]}}var ObjectDict=[0,function(param){return param?0:1},function(x,_param){for(;;){var param=_param;if(param){var c=caml_string_compare(x,param[1]);if(c){_param=c<0?param[0]:param[3];continue}return 1}return 0}},add$3,singleton,remove$1,merge$1,function(cmp,m1,m2){for(var _e1=cons_enum(m1,0),_e2=cons_enum(m2,0);;){var e2=_e2,e1=_e1;if(e1){if(e2){var c=caml_string_compare(e1[0],e2[0]);if(0!==c)return c;var c$1=_2(cmp,e1[1],e2[1]);if(0!==c$1)return c$1;_e2=cons_enum(e2[2],e2[3]),_e1=cons_enum(e1[2],e1[3]);continue}return 1}return e2?-1:0}},function(cmp,m1,m2){for(var _e1=cons_enum(m1,0),_e2=cons_enum(m2,0);;){var e2=_e2,e1=_e1;if(e1){if(e2){if(caml_string_compare(e1[0],e2[0]))return 0;if(_2(cmp,e1[1],e2[1])){_e2=cons_enum(e2[2],e2[3]),_e1=cons_enum(e1[2],e1[3]);continue}return 0}return 0}return e2?0:1}},iter$4,fold,for_all$1,exists$1,filter$1,partition$1,cardinal,function(s){return bindings_aux(0,s)},min_binding,function(_param){for(;;){var param=_param;if(param){var r=param[3];if(r){_param=r;continue}return[param[1],param[2]]}throw not_found}},min_binding,split$1,function(x,_param){for(;;){var param=_param;if(param){var c=caml_string_compare(x,param[1]);if(c){_param=c<0?param[0]:param[3];continue}return param[2]}throw not_found}},map$7,mapi$4],ParseFail=create("Tea_json.Decoder.ParseFail");function $$null(v){return[function(value){var match=classify(value);return"number"==typeof match&&match>=2?__(0,[v]):__(1,["Non-null value"])}]}function field(key,param){var decoder=param[0];return[function(value){var match=classify(value);if("number"==typeof match)return __(1,["Non-fieldable value"]);if(2===match.tag){var match$1=match[0][key];if(void 0!==match$1){var o=_1(decoder,match$1);return o.tag?__(1,["field `"+key+"` -> "+o[0]]):o}return __(1,["Field Value is undefined: "+key])}return __(1,["Non-fieldable value"])}]}function oneOf(decoders){return[function(value){var parse=function(v,_param){for(;;){var param=_param;if(!param)return __(1,["No one-of's matched"]);var rest=param[1];try{var ok$$1=_1(param[0][0],v);return ok$$1.tag?parse(v,rest):ok$$1}catch(exn){_param=rest;continue}}};return parse(value,decoders)}]}function map$1$1(mapper,param){var decoder1=param[0];return[function(value){var match=_1(decoder1,value);return match.tag?__(1,["map "+match[0]]):__(0,[_1(mapper,match[0])])}]}function andThen(func,param){var decoder=param[0];return[function(value){var err=_1(decoder,value);if(err.tag)return err;return _1(_1(func,err[0])[0],value)}]}function decodeValue(param,value){try{return _1(param[0],value)}catch(raw_exn){var exn=internalToOCamlException(raw_exn);return exn[0]===ParseFail?__(1,[exn[1]]):__(1,["Unknown JSON parsing error"])}}var Decoder=[ObjectDict,ParseFail,[function(value){var match=classify(value);return"number"==typeof match?__(1,["Non-string value"]):match.tag?__(1,["Non-string value"]):__(0,[match[0]])}],[function(value){var match=classify(value);if("number"==typeof match)return __(1,["Non-int value"]);if(1===match.tag){var n=match[0];return n>-2147483648&&n<2147483647?__(0,[0|n]):__(1,["number out of int range"])}return __(1,["Non-int value"])}],[function(value){var match=classify(value);return"number"==typeof match?__(1,["Non-float-value"]):1===match.tag?__(0,[match[0]]):__(1,["Non-float-value"])}],[function(value){var match=classify(value);if("number"!=typeof match)return __(1,["Non-boolean value"]);switch(match){case 0:return __(0,[0]);case 1:return __(0,[1]);case 2:return __(1,["Non-boolean value"])}}],$$null,function(param){var decoder=param[0];return[function(value){var match=classify(value);if("number"==typeof match)return __(1,["Non-list value"]);if(3!==match.tag)return __(1,["Non-list value"]);try{return __(0,[map(function(v){var match=_1(decoder,v);if(match.tag)throw[ParseFail,match[0]];return match[0]},function(a){for(var _i=a.length-1|0,_res=0;;){var res=_res,i=_i;if(i<0)return res;_res=[a[i],res],_i=i-1|0}}(match[0]))])}catch(raw_exn){var exn=internalToOCamlException(raw_exn);if(exn[0]===ParseFail)return __(1,["list -> "+exn[1]]);throw exn}}]},function(param){var decoder=param[0];return[function(value){var match=classify(value);if("number"==typeof match)return __(1,["Non-array value"]);if(3!==match.tag)return __(1,["Non-array value"]);try{return __(0,[function(f,a){var l=a.length;if(l){for(var r=caml_make_vect(l,_1(f,a[0])),i=1,i_finish=l-1|0;i<=i_finish;++i)r[i]=_1(f,a[i]);return r}return[]}(function(v){var match=_1(decoder,v);if(match.tag)throw[ParseFail,match[0]];return match[0]},match[0])])}catch(raw_exn){var exn=internalToOCamlException(raw_exn);if(exn[0]===ParseFail)return __(1,["array -> "+exn[1]]);throw exn}}]},function(param){var decoder=param[0];return[function(value){var match=classify(value);if("number"==typeof match)return __(1,["Non-keyValuePair value"]);if(2!==match.tag)return __(1,["Non-keyValuePair value"]);var o=match[0],keys=Object.keys(o);try{return __(0,[fold_right$1(function(k,l){var match=o[k];if(void 0!==match){var match$1=_1(decoder,match);if(match$1.tag)throw[ParseFail,match$1[0]];return[[k,match$1[0]],l]}throw[ParseFail,"Key is undefined: "+k]},keys,0)])}catch(raw_exn){var exn=internalToOCamlException(raw_exn);if(exn[0]===ParseFail)return __(1,["Invalid keyValuePair parsing: "+exn[1]]);throw exn}}]},function(param){var decoder=param[0];return[function(value){var match=classify(value);if("number"==typeof match)return __(1,["Non-dict value"]);if(2!==match.tag)return __(1,["Non-dict value"]);var o=match[0],keys=Object.keys(o);try{return __(0,[fold_right$1(function(k,d){var match=o[k];if(void 0!==match){var match$1=_1(decoder,match);if(match$1.tag)throw[ParseFail,match$1[0]];return add$3(k,match$1[0],d)}throw[ParseFail,"Key is undefined: "+k]},keys,0)])}catch(raw_exn){var exn=internalToOCamlException(raw_exn);if(exn[0]===ParseFail)return __(1,["Invalid dict parsing: "+exn[1]]);throw exn}}]},field,function(fields,dec){return fold_right(field,fields,dec)},function(idx,param){var decoder=param[0];return[function(value){var match=classify(value);if("number"==typeof match)return __(1,["Non-array value"]);if(3===match.tag){var a=match[0];return idx<0||idx>a.length?__(1,["Array index out of range: "+idx]):_1(decoder,caml_array_get(a,idx))}return __(1,["Non-array value"])}]},function(param){var decoder=param[0];return[function(value){var match=_1(decoder,value);return match.tag?__(0,[0]):__(0,[[match[0]]])}]},oneOf,map$1$1,function(mapper,param,param$1){var decoder2=param$1[0],decoder1=param[0];return[function(value){var match=_1(decoder1,value),match$1=_1(decoder2,value),exit$$1=0;if(match.tag)exit$$1=1;else{if(!match$1.tag)return __(0,[_2(mapper,match[0],match$1[0])]);exit$$1=1}if(1===exit$$1){var match$2=(fst=match,param=match$1,param.tag?[param[0]]:function(param){return param.tag?[param[0]]:0}(fst));if(match$2)return __(1,["map2 -> "+match$2[0]]);throw[failure,"Impossible case"]}var fst,param}]},function(mapper,param,param$1,param$2){var decoder3=param$2[0],decoder2=param$1[0],decoder1=param[0];return[function(value){var match=_1(decoder1,value),match$1=_1(decoder2,value),match$2=_1(decoder3,value),exit$$1=0;if(match.tag)exit$$1=1;else if(match$1.tag)exit$$1=1;else{if(!match$2.tag)return __(0,[_3(mapper,match[0],match$1[0],match$2[0])]);exit$$1=1}if(1===exit$$1){var match$3=first(match$2,first(match$1,match));if(match$3.tag)return __(1,["map3 -> "+match$3[0]]);throw[failure,"Impossible case"]}}]},function(mapper,param,param$1,param$2,param$3){var decoder4=param$3[0],decoder3=param$2[0],decoder2=param$1[0],decoder1=param[0];return[function(value){var match=_1(decoder1,value),match$1=_1(decoder2,value),match$2=_1(decoder3,value),match$3=_1(decoder4,value),exit$$1=0;if(match.tag)exit$$1=1;else if(match$1.tag)exit$$1=1;else if(match$2.tag)exit$$1=1;else{if(!match$3.tag)return __(0,[_4(mapper,match[0],match$1[0],match$2[0],match$3[0])]);exit$$1=1}if(1===exit$$1){var match$4=first(match$3,first(match$2,first(match$1,match)));if(match$4.tag)return __(1,["map4 -> "+match$4[0]]);throw[failure,"Impossible case"]}}]},function(mapper,param,param$1,param$2,param$3,param$4){var decoder5=param$4[0],decoder4=param$3[0],decoder3=param$2[0],decoder2=param$1[0],decoder1=param[0];return[function(value){var match=_1(decoder1,value),match$1=_1(decoder2,value),match$2=_1(decoder3,value),match$3=_1(decoder4,value),match$4=_1(decoder5,value),exit$$1=0;if(match.tag)exit$$1=1;else if(match$1.tag)exit$$1=1;else if(match$2.tag)exit$$1=1;else if(match$3.tag)exit$$1=1;else{if(!match$4.tag)return __(0,[_5(mapper,match[0],match$1[0],match$2[0],match$3[0],match$4[0])]);exit$$1=1}if(1===exit$$1){var match$5=first(match$4,first(match$3,first(match$2,first(match$1,match))));if(match$5.tag)return __(1,["map5 -> "+match$5[0]]);throw[failure,"Impossible case"]}}]},function(mapper,param,param$1,param$2,param$3,param$4,param$5){var decoder6=param$5[0],decoder5=param$4[0],decoder4=param$3[0],decoder3=param$2[0],decoder2=param$1[0],decoder1=param[0];return[function(value){var match=_1(decoder1,value),match$1=_1(decoder2,value),match$2=_1(decoder3,value),match$3=_1(decoder4,value),match$4=_1(decoder5,value),match$5=_1(decoder6,value),exit$$1=0;if(match.tag)exit$$1=1;else if(match$1.tag)exit$$1=1;else if(match$2.tag)exit$$1=1;else if(match$3.tag)exit$$1=1;else if(match$4.tag)exit$$1=1;else{if(!match$5.tag)return __(0,[_6(mapper,match[0],match$1[0],match$2[0],match$3[0],match$4[0],match$5[0])]);exit$$1=1}if(1===exit$$1){var match$6=first(match$5,first(match$4,first(match$3,first(match$2,first(match$1,match)))));if(match$6.tag)return __(1,["map6 -> "+match$6[0]]);throw[failure,"Impossible case"]}}]},function(mapper,param,param$1,param$2,param$3,param$4,param$5,param$6){var decoder7=param$6[0],decoder6=param$5[0],decoder5=param$4[0],decoder4=param$3[0],decoder3=param$2[0],decoder2=param$1[0],decoder1=param[0];return[function(value){var match=_1(decoder1,value),match$1=_1(decoder2,value),match$2=_1(decoder3,value),match$3=_1(decoder4,value),match$4=_1(decoder5,value),match$5=_1(decoder6,value),match$6=_1(decoder7,value),exit$$1=0;if(match.tag)exit$$1=1;else if(match$1.tag)exit$$1=1;else if(match$2.tag)exit$$1=1;else if(match$3.tag)exit$$1=1;else if(match$4.tag)exit$$1=1;else if(match$5.tag)exit$$1=1;else{if(!match$6.tag)return __(0,[_7(mapper,match[0],match$1[0],match$2[0],match$3[0],match$4[0],match$5[0],match$6[0])]);exit$$1=1}if(1===exit$$1){var match$7=first(match$6,first(match$5,first(match$4,first(match$3,first(match$2,first(match$1,match))))));if(match$7.tag)return __(1,["map7 -> "+match$7[0]]);throw[failure,"Impossible case"]}}]},function(mapper,param,param$1,param$2,param$3,param$4,param$5,param$6,param$7){var decoder8=param$7[0],decoder7=param$6[0],decoder6=param$5[0],decoder5=param$4[0],decoder4=param$3[0],decoder3=param$2[0],decoder2=param$1[0],decoder1=param[0];return[function(value){var match=_1(decoder1,value),match$1=_1(decoder2,value),match$2=_1(decoder3,value),match$3=_1(decoder4,value),match$4=_1(decoder5,value),match$5=_1(decoder6,value),match$6=_1(decoder7,value),match$7=_1(decoder8,value),exit$$1=0;if(match.tag)exit$$1=1;else if(match$1.tag)exit$$1=1;else if(match$2.tag)exit$$1=1;else if(match$3.tag)exit$$1=1;else if(match$4.tag)exit$$1=1;else if(match$5.tag)exit$$1=1;else if(match$6.tag)exit$$1=1;else{if(!match$7.tag)return __(0,[_8(mapper,match[0],match$1[0],match$2[0],match$3[0],match$4[0],match$5[0],match$6[0],match$7[0])]);exit$$1=1}if(1===exit$$1){var match$8=first(match$7,first(match$6,first(match$5,first(match$4,first(match$3,first(match$2,first(match$1,match)))))));if(match$8.tag)return __(1,["map8 -> "+match$8[0]]);throw[failure,"Impossible case"]}}]},function(v){return[function(){return __(0,[v])}]},function(e){return[function(){return __(1,[e])}]},[function(value){return __(0,[value])}],andThen,function(func){return andThen(func,[function(){return __(0,[0])}])},function(decoder){return oneOf([$$null(0),[map$1$1(function(v){return[v]},decoder),0]])},decodeValue,function(param,value){try{return _1(param[0],value)}catch(raw_exn){var exn=internalToOCamlException(raw_exn);return exn[0]===ParseFail?__(1,[exn[1]]):__(1,["Unknown JSON parsing error"])}},function(decoder,string){try{return decodeValue(decoder,JSON.parse(string))}catch(exn){return __(1,["Invalid JSON string"])}}],position=Decoder[17](function(x,y){return[x,y]},Decoder[11]("pageX",Decoder[3]),Decoder[11]("pageY",Decoder[3]));function registerGlobal(name,key,tagger){return registration(key,function(callbacks_base){var callbacks=[callbacks_base],handler=__(0,[key,function(ev){var match=Decoder[31](position,ev);return match.tag?0:[_1(tagger,match[0])]}]),elem=document,cache=eventHandler_Register(callbacks,elem,name,handler);return function(){return eventHandler_Unregister(elem,name,cache),0}})}function cartesian_decoder(field_x,field_y){return Decoder[17](function(x,y){return[x,y]},Decoder[11](field_x,Decoder[3]),Decoder[11](field_y,Decoder[3]))}cartesian_decoder("pageX","pageY");var size=Decoder[11]("clientWidth",Decoder[3]),partial_arg$2=Decoder[18](function(a$$1,b,c){return[a$$1,b,c]},cartesian_decoder("offsetX","offsetY"),cartesian_decoder("pageX","pageY"),Decoder[11]("target",size)),partial_arg$3=Decoder[31];function offset_page_size(param){return partial_arg$3(partial_arg$2,param)}function adjust_coordinates(orientation,coordinates,drag){var newrecord=drag.slice();return newrecord[2]=function(orientation,drag){var x$prime=(drag[6][0]-drag[4][0]|0)+drag[5][0]|0,y$prime=(drag[6][1]-drag[4][1]|0)+drag[5][1]|0,x=x$prime<0?x$prime-drag[7]|0:x$prime,y=y$prime<0?y$prime-drag[7]|0:y$prime,match=drag[1],ii=match[1],i=match[0],match$1=0!==orientation?[i+div(x,drag[7])|0,ii-div(y,drag[7])|0]:[i-div(x,drag[7])|0,ii+div(y,drag[7])|0],ii$prime=match$1[1],i$prime=match$1[0];return i$prime>=0&&i$prime<=7&&ii$prime>=0&&ii$prime<=7?[[i$prime,ii$prime]]:0}(orientation,drag),newrecord[6]=coordinates,newrecord}var buttons_view=[button(0,0,[onClick(__(0,[0])),0],[text$1("flip board"),0]),0];function board_view(interactable,pos_ar,model){var move_start;if(interactable){var legal_moves$$1=interactable[1],turn=interactable[0];move_start=[[function(file,rank,param){var coordinates=param[1];return __(0,[__(0,[[turn,[file,rank],0,(source=[file,rank],moves$$1=map(function(param){return function(turn,move){var home_rank=function(param){return 0!==param?0:7};if("number"==typeof move)return move?[[4,home_rank(turn)],[2,home_rank(turn)],[1]]:[[4,home_rank(turn)],[6,home_rank(turn)],[0]];if(move.tag)return[[move[1],(param=turn,0!==param?6:1)],[move[2],function(param){return 0!==param?7:0}(turn)],0];var t_rank=move[3],t_file=move[2],s_rank=move[1],s_file=move[0];return[[s_file,s_rank],[t_file,t_rank],[__(0,[s_file,s_rank,t_file,t_rank])]];var param}(turn,param)},legal_moves$$1),map(function(param){return[param[1],param[2]]},filter(function(param){return caml_equal(param[0],source)})(moves$$1))),coordinates,param[0],coordinates,param[2]]])]);var source,moves$$1},turn]]}else move_start=0;var match$1=0!==model[0]?[[0,[1,[2,[3,[4,[5,[6,[7,0]]]]]]]],[7,[6,[5,[4,[3,[2,[1,[0,0]]]]]]]]]:[[7,[6,[5,[4,[3,[2,[1,[0,0]]]]]]]],[0,[1,[2,[3,[4,[5,[6,[7,0]]]]]]]]],files=match$1[0];return node$1(0,"cb-board",0,0,0,map(function(rank){return node$1(0,"cb-row",0,0,0,map(function(param){var tmp,rank$1=rank,file=param,match=model[1];if("number"==typeof match)tmp=noProp$1;else if(match.tag)tmp=noProp$1;else{var drag=match[0];tmp=classList([["destination",function(drag,target){return function(p,_param){for(;;){var param=_param;if(!param)return 0;if(_1(p,param[0]))return 1;_param=param[1]}}(function(param){return caml_equal(param[0],target)},drag[3])}(drag,[file,rank$1])],[["hovering",function(drag,target){var match=drag[2];return match&&caml_equal(match[0],target)?1:0}(drag,[file,rank$1])],0]])}var tmp$1,match$1=caml_array_get(caml_array_get(pos_ar,file),rank$1);if(match$1){var listener,match$2=match$1[0],color=match$2[1];if(move_start){var match$3=move_start[0];if(color===match$3[1]){var partial_arg=_2(match$3[0],file,rank$1);listener=onCB$1("mousedown","",function(param){return function(decoder,msg$$1,$$event){var result=_1(decoder,$$event);return result.tag?0:[_1(msg$$1,result[0])]}(offset_page_size,partial_arg,param)})}else listener=noProp$1}else listener=noProp$1;var styles,match$4=model[1];if("number"==typeof match$4)styles=noProp$1;else if(match$4.tag)styles=noProp$1;else{var drag$1=match$4[0];styles=caml_equal([file,rank$1],drag$1[1])?styles$1([["z-index","9"],[["transform",_2(sprintf([__(11,["translate(",__(4,[0,0,0,__(11,["px,",__(4,[0,0,0,__(11,["px)",0])])])])]),"translate(%dpx,%dpx)"]),((drag$1[5][0]-(drag$1[7]/2|0)|0)+drag$1[6][0]|0)-drag$1[4][0]|0,((drag$1[5][1]-(drag$1[7]/2|0)|0)+drag$1[6][1]|0)-drag$1[4][1]|0)],0]]):noProp$1}tmp$1=node$1(0,"cb-piece",0,0,[listener,[styles,[classList([[string_of_color(color),1],[[string_of_piece_type(match$2[0]),1],0]]),0]]],0)}else tmp$1=noNode$1;return node$1(0,"cb-square",0,0,[tmp,0],[tmp$1,0])},files))},match$1[1]))}function subscriptions$1(model){var match=model[1];return"number"==typeof match||match.tag?none$1:batch$1([($staropt$star=0,tagger=function(x){return __(0,[__(1,[x])])},registerGlobal("mousemove",$staropt$star?$staropt$star[0]:"",tagger)),[function($staropt$star,tagger){return registerGlobal("mouseup",$staropt$star?$staropt$star[0]:"",tagger)}(0,function(x){return __(0,[__(2,[x])])}),0]]);var $staropt$star,tagger}var End_of_list=create("Zipper.End_of_list"),Beginning_of_list=create("Zipper.Beginning_of_list");function fwd(param){var future=param[1];if(future){var hd=future[0];return[hd,[[hd,param[0]],future[1]]]}throw End_of_list}function back(param){var past=param[0];if(past)return[past[1],[past[0],param[1]]];throw Beginning_of_list}function programStateWrapper(initModel,pump,shutdown){var model=[initModel],callbacks=[[function(){return console.log("INVALID enqueue CALL!"),0}]],pumperInterface=_1(pump,callbacks),pending=[0],handler=function(msg$$1){var match=pending[0];if(match)return pending[0]=[[msg$$1,match[0]]],0;pending[0]=[0];var newModel=_2(pumperInterface[2],model[0],msg$$1);model[0]=newModel;var match$1=pending[0];if(match$1){var msgs=match$1[0];return msgs?(pending[0]=0,iter(handler,rev_append(msgs,0))):(pending[0]=0,0)}throw[failure,"INVALID message queue state, should never be None during message processing!"]},finalizedCBs=[handler];callbacks[0]=finalizedCBs;return _1(pumperInterface[0],0),{pushMsg:handler,shutdown:function(){callbacks[0]=[function(){return console.log("INVALID message enqueued when shut down"),0}];var cmd=_1(shutdown,model[0]);return _1(pumperInterface[3],cmd),0},getHtmlString:function(){return _1(pumperInterface[1],model[0])}}}function programLoop(update,view,subscriptions,initModel,initCmd,param){if(param){var parentNode=param[0];return function(callbacks){var priorRenderedVdom=[0],latestModel=[initModel],nextFrameID=[0],doRender=function(){if(nextFrameID[0]){var newVdom=[_1(view,latestModel[0]),0],justRenderedVdom=function(callbacks,elem,oldVNodes,newVNodes){return patchVNodesOnElems(callbacks,elem,elem.childNodes,0,oldVNodes,newVNodes),newVNodes}(callbacks,parentNode,priorRenderedVdom[0],newVdom);return priorRenderedVdom[0]=justRenderedVdom,nextFrameID[0]=0,0}return 0},clearPnode=function(){for(;parentNode.childNodes.length>0;){var match=parentNode.firstChild;null!==match&&parentNode.removeChild(match)}return 0},oldSub=[0],handleSubscriptionChange=function(model){var newSub=_1(subscriptions,model);return oldSub[0]=run$1(callbacks,callbacks,oldSub[0],newSub),0};return[function(){return clearPnode(),run(callbacks,initCmd),handleSubscriptionChange(latestModel[0]),nextFrameID[0]=[-1],doRender(),0},function(model){return renderToHtmlString(_1(view,model))},function(model,msg$$1){var match=_2(update,model,msg$$1),newModel=match[0];return latestModel[0]=newModel,run(callbacks,match[1]),!nextFrameID[0]&&(nextFrameID[0]=[-1],doRender()),handleSubscriptionChange(newModel),newModel},function(cmd){return nextFrameID[0]=0,run(callbacks,cmd),oldSub[0]=run$1(callbacks,callbacks,oldSub[0],0),priorRenderedVdom[0]=0,clearPnode(),0}]}}return function(callbacks){var oldSub=[0],handleSubscriptionChange=function(model){var newSub=_1(subscriptions,model);return oldSub[0]=run$1(callbacks,callbacks,oldSub[0],newSub),0};return[function(){return run(callbacks,initCmd),handleSubscriptionChange(initModel),0},function(model){return renderToHtmlString(_1(view,model))},function(model,msg$$1){var match=_2(update,model,msg$$1),newModel=match[0];return run(callbacks,match[1]),handleSubscriptionChange(newModel),newModel},function(cmd){return run(callbacks,cmd),oldSub[0]=run$1(callbacks,callbacks,oldSub[0],0),0}]}}function program(param,pnode,flags){"remove"in Element.prototype||(Element.prototype.remove=function(){this.parentNode&&this.parentNode.removeChild(this)}),function(){for(var lastTime=0,vendors=["ms","moz","webkit","o"],x=0;x<vendors.length&&!window.requestAnimationFrame;++x)window.requestAnimationFrame=window[vendors[x]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[vendors[x]+"CancelAnimationFrame"]||window[vendors[x]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(callback,element){var currTime=(new Date).getTime(),timeToCall=Math.max(0,16-(currTime-lastTime)),id=window.setTimeout(function(){callback(currTime+timeToCall)},timeToCall);return lastTime=currTime+timeToCall,id}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(id){clearTimeout(id)})}();var match=_1(param[0],flags),initModel=match[0],opnode=null==pnode?0:[pnode];return programStateWrapper(initModel,programLoop(param[1],param[2],param[3],initModel,match[1],opnode),param[4])}var map$8=function(func,vdom){return __(4,[function(callbacks){return[[function(msg){return _1(callbacks[0][0],_1(func,msg))}]]},vdom])},key_event=Decoder[20](function(key_code,shift,ctrl,alt,meta){return[key_code,shift,ctrl,alt,meta]},Decoder[11]("keyCode",Decoder[3]),Decoder[11]("shiftKey",Decoder[5]),Decoder[11]("ctrlKey",Decoder[5]),Decoder[11]("altKey",Decoder[5]),Decoder[11]("metaKey",Decoder[5]));function downs$1($staropt$star,tagger){return function(name,key,tagger){return registration(key,function(callbacks_base){var callbacks=[callbacks_base],handler=__(0,[key,function(ev){var match=Decoder[31](key_event,ev);return match.tag?0:[_1(tagger,match[0])]}]),elem=document,cache=eventHandler_Register(callbacks,elem,name,handler);return function(){return eventHandler_Unregister(elem,name,cache),0}})}("keydown",$staropt$star?$staropt$star[0]:"",tagger)}var max_int$2=2147483647,max_int$3=[2147483647,4294967295];function cmn(q,a,b,x,s,t){var a$1=((a+q|0)+x|0)+t|0;return(a$1<<s|a$1>>>(32-s|0)|0)+b|0}function f(a,b,c,d,x,s,t){return cmn(b&c|(-1^b)&d,a,b,x,s,t)}function g(a,b,c,d,x,s,t){return cmn(b&d|c&(-1^d),a,b,x,s,t)}function h(a,b,c,d,x,s,t){return cmn(b^c^d,a,b,x,s,t)}function i$2(a,b,c,d,x,s,t){return cmn(c^(b|-1^d),a,b,x,s,t)}function cycle(x,k){var a=x[0],b=x[1],c=x[2],d=x[3];return b=i$2(b=i$2(b=i$2(b=i$2(b=h(b=h(b=h(b=h(b=g(b=g(b=g(b=g(b=f(b=f(b=f(b=f(b,c=f(c,d=f(d,a=f(a,b,c,d,k[0],7,-680876936),b,c,k[1],12,-389564586),a,b,k[2],17,606105819),d,a,k[3],22,-1044525330),c=f(c,d=f(d,a=f(a,b,c,d,k[4],7,-176418897),b,c,k[5],12,1200080426),a,b,k[6],17,-1473231341),d,a,k[7],22,-45705983),c=f(c,d=f(d,a=f(a,b,c,d,k[8],7,1770035416),b,c,k[9],12,-1958414417),a,b,k[10],17,-42063),d,a,k[11],22,-1990404162),c=f(c,d=f(d,a=f(a,b,c,d,k[12],7,1804603682),b,c,k[13],12,-40341101),a,b,k[14],17,-1502002290),d,a,k[15],22,1236535329),c=g(c,d=g(d,a=g(a,b,c,d,k[1],5,-165796510),b,c,k[6],9,-1069501632),a,b,k[11],14,643717713),d,a,k[0],20,-373897302),c=g(c,d=g(d,a=g(a,b,c,d,k[5],5,-701558691),b,c,k[10],9,38016083),a,b,k[15],14,-660478335),d,a,k[4],20,-405537848),c=g(c,d=g(d,a=g(a,b,c,d,k[9],5,568446438),b,c,k[14],9,-1019803690),a,b,k[3],14,-187363961),d,a,k[8],20,1163531501),c=g(c,d=g(d,a=g(a,b,c,d,k[13],5,-1444681467),b,c,k[2],9,-51403784),a,b,k[7],14,1735328473),d,a,k[12],20,-1926607734),c=h(c,d=h(d,a=h(a,b,c,d,k[5],4,-378558),b,c,k[8],11,-2022574463),a,b,k[11],16,1839030562),d,a,k[14],23,-35309556),c=h(c,d=h(d,a=h(a,b,c,d,k[1],4,-1530992060),b,c,k[4],11,1272893353),a,b,k[7],16,-155497632),d,a,k[10],23,-1094730640),c=h(c,d=h(d,a=h(a,b,c,d,k[13],4,681279174),b,c,k[0],11,-358537222),a,b,k[3],16,-722521979),d,a,k[6],23,76029189),c=h(c,d=h(d,a=h(a,b,c,d,k[9],4,-640364487),b,c,k[12],11,-421815835),a,b,k[15],16,530742520),d,a,k[2],23,-995338651),c=i$2(c,d=i$2(d,a=i$2(a,b,c,d,k[0],6,-198630844),b,c,k[7],10,1126891415),a,b,k[14],15,-1416354905),d,a,k[5],21,-57434055),c=i$2(c,d=i$2(d,a=i$2(a,b,c,d,k[12],6,1700485571),b,c,k[3],10,-1894986606),a,b,k[10],15,-1051523),d,a,k[1],21,-2054922799),c=i$2(c,d=i$2(d,a=i$2(a,b,c,d,k[8],6,1873313359),b,c,k[15],10,-30611744),a,b,k[6],15,-1560198380),d,a,k[13],21,1309151649),c=i$2(c,d=i$2(d,a=i$2(a,b,c,d,k[4],6,-145523070),b,c,k[11],10,-1120210379),a,b,k[2],15,718787259),d,a,k[9],21,-343485551),x[0]=a+x[0]|0,x[1]=b+x[1]|0,x[2]=c+x[2]|0,x[3]=d+x[3]|0,0}var state=[1732584193,-271733879,-1732584194,271733878],md5blk=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];function string$1$1(str){return function(s,start,len){var s$1=s.slice(start,len),n=s$1.length;state[0]=1732584193,state[1]=-271733879,state[2]=-1732584194,state[3]=271733878;for(var i=0;i<=15;++i)md5blk[i]=0;for(var i_end=n/64|0,i$1=1;i$1<=i_end;++i$1){for(var j=0;j<=15;++j){var k=((i$1<<6)-64|0)+(j<<2)|0;md5blk[j]=((s$1.charCodeAt(k)+(s$1.charCodeAt(k+1|0)<<8)|0)+(s$1.charCodeAt(k+2|0)<<16)|0)+(s$1.charCodeAt(k+3|0)<<24)|0}cycle(state,md5blk)}for(var s_tail=s$1.slice(i_end<<6),kk=0;kk<=15;++kk)md5blk[kk]=0;for(var i_end$1=s_tail.length-1|0,i$2=0;i$2<=i_end$1;++i$2)md5blk[i$2/4|0]=md5blk[i$2/4|0]|s_tail.charCodeAt(i$2)<<(i$2%4<<3);var i$3=i_end$1+1|0;if(md5blk[i$3/4|0]=md5blk[i$3/4|0]|128<<(i$3%4<<3),i$3>55){cycle(state,md5blk);for(var i$4=0;i$4<=15;++i$4)md5blk[i$4]=0}return md5blk[14]=n<<3,cycle(state,md5blk),String.fromCharCode(255&state[0],state[0]>>8&255,state[0]>>16&255,state[0]>>24&255,255&state[1],state[1]>>8&255,state[1]>>16&255,state[1]>>24&255,255&state[2],state[2]>>8&255,state[2]>>16&255,state[2]>>24&255,255&state[3],state[3]>>8&255,state[3]>>16&255,state[3]>>24&255)}(str,0,str.length)}function assign(st1,st2){return function(a1,ofs1,a2,ofs2,len){if(len<0||ofs1<0||ofs1>(a1.length-len|0)||ofs2<0||ofs2>(a2.length-len|0))throw[invalid_argument,"Array.blit"];(function(a1,i1,a2,i2,len){if(i2<=i1){for(var j=0,j_finish=len-1|0;j<=j_finish;++j)a2[j+i2|0]=a1[j+i1|0];return 0}for(var j$1=len-1|0;j$1>=0;--j$1)a2[j$1+i2|0]=a1[j$1+i1|0]})(a1,ofs1,a2,ofs2,len)}(st2[0],0,st1[0],0,55),st1[1]=st2[1],0}function full_init(s,seed){for(var combine=function(accu,x){return string$1$1(accu+x)},seed$1=seed.length?seed:[0],l=seed$1.length,i=0;i<=54;++i)caml_array_set(s[0],i,i);for(var accu="x",i$1=0,i_finish=54+max(55,l)|0;i$1<=i_finish;++i$1){var j=i$1%55;accu=combine(accu,caml_array_get(seed$1,i$1%l)),caml_array_set(s[0],j,1073741823&(caml_array_get(s[0],j)^(d=accu,((get(d,0)+(get(d,1)<<8)|0)+(get(d,2)<<16)|0)+(get(d,3)<<24)|0)))}var d;return s[1]=0,0}function make$2(seed){var result=[caml_make_vect(55,0),0];return full_init(result,seed),result}function copy$3(s){var result=[caml_make_vect(55,0),0];return assign(result,s),result}function bits(s){s[1]=(s[1]+1|0)%55;var curval=caml_array_get(s[0],s[1]),newval30=1073741823&(caml_array_get(s[0],(s[1]+24|0)%55)+(curval^curval>>>25&31)|0);return caml_array_set(s[0],s[1],newval30),newval30}function int32(s,bound){if(bound<=0)throw[invalid_argument,"Random.int32"];for(var s$1=s,n=bound;;){var r=bits(s$1)|(1&bits(s$1))<<30,v=r%n;if(!((r-v|0)>(1+(max_int$2-n|0)|0)))return v}}function int64(s,bound){if(1-gt(bound,[0,0]))throw[invalid_argument,"Random.int64"];for(var s$1=s,n=bound;;){var b1=of_int32(bits(s$1)),b2=lsl_(of_int32(bits(s$1)),30),b3=lsl_(of_int32(7&bits(s$1)),60),r=(param=b1,param$1=[b2[0]|b3[0],(b2[1]|b3[1])>>>0],[param[0]|param$1[0],(param[1]|param$1[1])>>>0]),v=(self=r,other=n,add(self,neg(mul(div$1(self,other),other))));if(!gt(sub(r,v),add(sub(max_int$3,n),[0,1])))return v}var self,other,param,param$1}var $$default=[[987910699,495797812,364182224,414272206,318284740,990407751,383018966,270373319,840823159,24560019,536292337,512266505,189156120,730249596,143776328,51606627,140166561,366354223,1003410265,700563762,981890670,913149062,526082594,1021425055,784300257,667753350,630144451,949649812,48546892,415514493,258888527,511570777,89983870,283659902,308386020,242688715,482270760,865188196,1027664170,207196989,193777847,619708188,671350186,149669678,257044018,87658204,558145612,183450813,28133145,901332182,710253903,510646120,652377910,409934019,801085050],0];var State=[make$2,function(){return make$2(caml_sys_random_seed())},copy$3,bits,function(s,bound){if(bound>1073741823||bound<=0)throw[invalid_argument,"Random.int"];for(var s$1=s,n=bound;;){var r=bits(s$1),v=r%n;if(!((r-v|0)>(1+(1073741823-n|0)|0)))return v}},int32,function(s,bound){return 0|int64(s,of_int32(bound))[1]},int64,function(s,bound){return function(s){return(bits(s)/1073741824+bits(s))/1073741824}(s)*bound},function(s){return+(0==(1&bits(s)))}];!function(){return seed=caml_sys_random_seed(),full_init($$default,seed);var seed}();function generate(tagger,param){var genCmd=param[0];return __(2,[function(callbacks){var state=copy$3($$default),genValue=_1(genCmd,state);assign($$default,state);return _1(callbacks[0][0],_1(tagger,genValue))}])}function board_msg(param_0){return __(0,[param_0])}function key_pressed(param_0){return __(2,[param_0])}function init(){return[[init_position,[1,0],[0,0],0],none]}function update(model,param){var move$$1,exit$$1=0;if("number"==typeof param)switch(param){case 0:var tmp,match=game_status(model[0]);if("number"==typeof match)tmp=none;else if(match.tag){var move_list=match[0];tmp=generate(function(random_number){return __(1,[function(l,n){if(n<0)throw[invalid_argument,"List.nth"];for(var _l=l,_n=n;;){var l$1=_l;if(l$1){if(_n){_n=_n-1|0,_l=l$1[1];continue}return l$1[0]}throw[failure,"nth"]}}(move_list,random_number)])},(min$$1=0,max$$1=length(move_list),[function(state){return min$$1+State[4](state,max$$1)|0}]))}else tmp=none;return[model,tmp];case 1:var match$1=model[0][5];return[match$1?[match$1[0],model[1],back(model[2]),model[3]-1|0]:model,none];case 2:try{var match$2=fwd(model[2]);return[[make_move(model[0],match$2[0][0]),model[1],match$2[1],model[3]+1|0],none]}catch(exn){if(exn===End_of_list)return[model,none];throw exn}}else switch(0|param.tag){case 0:var match$3=param[0];if(!match$3.tag){var match$4=function(model,param){if(param.tag)return[model,none];var msg$$1=param[0],match=model[1];if("number"==typeof msg$$1)return msg$$1?[[model[0],0],none]:[[opposite_color(model[0]),model[1]],none];switch(0|msg$$1.tag){case 0:return[[model[0],__(0,[msg$$1[0]])],none];case 1:return"number"==typeof match?[model,none]:match.tag?[model,none]:[[model[0],__(0,[adjust_coordinates(model[0],msg$$1[0],match[0])])],none];case 2:if("number"==typeof match)return[model,none];if(match.tag)return[model,none];var drag=match[0],match$1=drag[2];if(!match$1)return[[model[0],0],none];var target=match$1[0];try{var match$2=assoc(target,drag[3]);return match$2?[[model[0],0],msg(__(1,[match$2[0]]))]:[[model[0],__(1,[[drag[0],drag[1][0],target[0],drag[7]]])],none]}catch(exn){if(exn===not_found)return[[model[0],0],none];throw exn}break;case 3:if("number"==typeof match)return[model,none];if(match.tag){var promoting=match[0],move=__(1,[msg$$1[0],promoting[1],promoting[2]]);return[[model[0],0],msg(__(1,[move]))]}return[model,none]}}(model[1],__(0,[match$3[0]]));return[[model[0],match$4[0],model[2],model[3]],map$4(board_msg,match$4[1])]}move$$1=match$3[0],exit$$1=1;break;case 1:move$$1=param[0],exit$$1=1;break;case 2:var tmp$1,key_event$$1=param[0],match$5=key_event$$1[2],match$6=key_event$$1[0],exit$1=0;if(0!==match$5)if(66!==match$6)if(match$6>=82)if(match$6>=85)exit$1=2;else switch(match$6-82|0){case 0:tmp$1=msg(0);break;case 1:exit$1=2;break;case 2:tmp$1=msg(1)}else 70!==match$6?exit$1=2:tmp$1=msg(2);else tmp$1=msg(1);else exit$1=2;if(2===exit$1){var switcher=match$6-37|0;if(switcher>2||switcher<0)tmp$1=none;else switch(switcher){case 0:tmp$1=msg(1);break;case 1:tmp$1=none;break;case 2:tmp$1=msg(2)}}return[model,tmp$1];case 3:var how_many=param[0];if(0!==how_many){var match$7=how_many>0?function(_position,_zipper,_n){for(;;){var n=_n,zipper=_zipper,position=_position;if(n<=0)return[position,zipper];var match=fwd(zipper);_n=n-1|0,_zipper=match[1],_position=make_move(position,match[0][0])}}(model[0],model[2],how_many):function(_position,_zipper,_n){for(;;){var n=_n,zipper=_zipper,position=_position,match=position[5];if(match){if(n<0){_n=n+1|0,_zipper=back(zipper),_position=match[0];continue}return[position,zipper]}return[position,zipper]}}(model[0],model[2],how_many);return[[match$7[0],model[1],match$7[1],model[3]+how_many|0],none]}return[model,none]}var min$$1,max$$1;if(1===exit$$1){var san=function(position,move){var move_list=map(function(param){return long_move(position,param)},legal_moves$1(position));return san_of_move$prime(position,move_list,move)}(model[0],move$$1);return[[make_move(model[0],move$$1),model[1],function(item,param){var future=param[1],past=param[0];if(future){var hd=future[0];return caml_equal(hd,item)?[[hd,past],future[1]]:[[item,past],0]}return[[item,past],0]}([move$$1,san],model[2]),model[3]+1|0],none]}}function move_view($staropt$star,current_ply,offset,param){var ply=1+(current_ply+offset|0)|0,number=ply/2|0;return li(0,0,[classList([["move",1],[["numbered",+(ply%2==0)],[["highlight",$staropt$star?$staropt$star[0]:0],0]]]),0],[span(0,0,[class$prime("number"),0],[text$1(function(param){return""+param}(number)),0]),[span(0,0,[class$prime("move"),[0!==offset?onClick(__(3,[offset])):noProp$1,0]],[text$1(param[1]),0]),0]])}function home_view(highlight,current_ply){return li(0,0,[classList([["move",1],[["highlight",highlight],0]]),0],[span(0,0,[class$prime("move"),[onClick(__(3,[0|-current_ply])),0]],[text$1("⌂"),0]),0])}function move_list_future_view(ply,future){for(var _offset=1,_cont=function(x){return x},_param=future;;){var param=_param,cont=_cont,offset=_offset;if(!param)return _1(cont,0);var hd$$1=param[0];_param=param[1],_cont=function(offset,cont,hd$$1){return function(acc){return _1(cont,[move_view(0,ply,offset,hd$$1),acc])}}(offset,cont,hd$$1),_offset=offset+1|0}}function move_list_view(ply,param){return $staropt$star=0,$staropt$star$1=0,props=[class$prime("moves"),0],nodes=[home_view(+(0===ply),ply),function(_offset,_acc,_param){for(;;){var param=_param,acc=_acc,offset=_offset;if(!param)return acc;_param=param[1],_acc=[move_view([+(0===offset)],ply,offset,param[0]),acc],_offset=offset-1|0}}(0,move_list_future_view(ply,param[1]),param[0])],fullnode("","ul",$staropt$star?$staropt$star[0]:"",$staropt$star$1?$staropt$star$1[0]:"",props,nodes);var $staropt$star,$staropt$star$1,props,nodes}function view(model){var interactable$$1,game_status$$1=game_status(model[0]);return interactable$$1="number"!=typeof game_status$$1&&game_status$$1.tag?[model[0][1],game_status$$1[0]]:0,$staropt$star=0,$staropt$star$1=0,props=0,nodes=[map$8(board_msg,function(interactable,pos_ar,model){var match=model[1];return node$1(0,"cb-wrap",0,0,0,["number"!=typeof match&&match.tag?function(promoting){var file=promoting[2],match=model[0],match$1=promoting[0],match$2=0!==match?0!==match$1?[file,[0,[1,[2,[3,0]]]]]:[file,[7,[6,[5,[4,0]]]]]:0!==match$1?[7-file|0,[7,[6,[5,[4,0]]]]]:[7-file|0,[0,[1,[2,[3,0]]]]],left=match$2[0];return node$1(0,"cb-promo",0,0,[onClick(__(0,[1])),0],map(function(param){var piece_type=param[1];return node$1(0,"cb-square",0,0,[styles$1([["left",_1(sprintf([__(4,[0,0,0,__(11,["px",0])]),"%dpx"]),imul(left,promoting[3]))],[["top",_1(sprintf([__(4,[0,0,0,__(11,["px",0])]),"%dpx"]),imul(param[0],promoting[3]))],0]]),0],[node$1(0,"cb-piece",0,0,[onClick(__(0,[__(3,[piece_type])])),[classList([[string_of_color(promoting[0]),1],[[string_of_piece_type(piece_type),1],0]]),0]],0),0])},combine(match$2[1],[1,[4,[2,[3,0]]]])))}(match[0]):noNode$1,[board_view(interactable,pos_ar,model),0]])}(interactable$$1,model[0][0],model[1])),[p(0,0,0,$at(map(function(param){return map$8(board_msg,param)},buttons_view),[button(0,0,[onClick(0),0],[text$1("random move"),0]),[button(0,0,[onClick(1),0],[text$1("back"),0]),[button(0,0,[onClick(2),0],[text$1("forward"),0]),0]]])),[(result=game_status$$1,p(0,0,0,[text$1("number"==typeof result?"The game is a draw!":result.tag?_1(sprintf([__(11,["There are ",__(4,[0,0,0,__(11,[" legal moves in this position!",0])])]),"There are %d legal moves in this position!"]),length(result[0])):0!==result[0]?"White wins by checkmate!":"Black wins by checkmate!"),0])),[move_list_view(model[3],model[2]),0]]]],fullnode("","div",$staropt$star?$staropt$star[0]:"",$staropt$star$1?$staropt$star$1[0]:"",props,nodes);var $staropt$star,$staropt$star$1,props,nodes,result}function subscriptions(model){return batch$1([(msgMapper=board_msg,sub=subscriptions$1(model[1]),__(2,[function(callbacks){return[[function(userMsg){return _1(callbacks[0][0],_1(msgMapper,userMsg))}]]},sub])),[downs$1(0,key_pressed),0]]);var msgMapper,sub}var partial_arg=[init,update,view,subscriptions];return exports.board_msg=board_msg,exports.random_button=0,exports.back_button=1,exports.fwd_button=2,exports.random_move=function(param_0){return __(1,[param_0])},exports.key_pressed=key_pressed,exports.jump=function(param_0){return __(3,[param_0])},exports.init=init,exports.update=update,exports.move_view=move_view,exports.home_view=home_view,exports.move_list_future_view=move_list_future_view,exports.move_list_view=move_list_view,exports.view=view,exports.subscriptions=subscriptions,exports.main=function(param,param$1){return function(param,pnode,args){return program([param[0],param[1],param[2],param[3],function(){return 0}],pnode,args)}(partial_arg,param,param$1)},exports}({});
